<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>Class: Origami::PDF</title>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
  <meta http-equiv="Content-Script-Type" content="text/javascript" />
  <link rel="stylesheet" href="../.././rdoc-style.css" type="text/css" media="screen" />
  <script type="text/javascript">
  // <![CDATA[

  function popupCode( url ) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }

  function toggleCode( id ) {
    if ( document.getElementById )
      elem = document.getElementById( id );
    else if ( document.all )
      elem = eval( "document.all." + id );
    else
      return false;

    elemStyle = elem.style;
    
    if ( elemStyle.display != "block" ) {
      elemStyle.display = "block"
    } else {
      elemStyle.display = "none"
    }

    return true;
  }
  
  // Make codeblocks hidden by default
  document.writeln( "<style type=\"text/css\">div.method-source-code { display: none }</style>" )
  
  // ]]>
  </script>

</head>
<body>



    <div id="classHeader">
        <table class="header-table">
        <tr class="top-aligned-row">
          <td><strong>Class</strong></td>
          <td class="class-name-in-header">Origami::PDF</td>
        </tr>
        <tr class="top-aligned-row">
            <td><strong>In:</strong></td>
            <td>
                <a href="../../files/sources/parser/encryption_rb.html">
                sources/parser/encryption.rb
                </a>
        <br />
                <a href="../../files/sources/parser/pdf_rb.html">
                sources/parser/pdf.rb
                </a>
        <br />
                <a href="../../files/sources/parser/trailer_rb.html">
                sources/parser/trailer.rb
                </a>
        <br />
                <a href="../../files/sources/parser/file_rb.html">
                sources/parser/file.rb
                </a>
        <br />
                <a href="../../files/sources/parser/xreftable_rb.html">
                sources/parser/xreftable.rb
                </a>
        <br />
                <a href="../../files/sources/parser/signature_rb.html">
                sources/parser/signature.rb
                </a>
        <br />
                <a href="../../files/sources/parser/linearization_rb.html">
                sources/parser/linearization.rb
                </a>
        <br />
                <a href="../../files/sources/parser/export_rb.html">
                sources/parser/export.rb
                </a>
        <br />
                <a href="../../files/sources/parser/acroform_rb.html">
                sources/parser/acroform.rb
                </a>
        <br />
                <a href="../../files/sources/parser/catalog_rb.html">
                sources/parser/catalog.rb
                </a>
        <br />
                <a href="../../files/sources/parser/page_rb.html">
                sources/parser/page.rb
                </a>
        <br />
                <a href="../../files/sources/parser/obfuscation_rb.html">
                sources/parser/obfuscation.rb
                </a>
        <br />
                <a href="../../files/sources/parser/metadata_rb.html">
                sources/parser/metadata.rb
                </a>
        <br />
                <a href="../../files/sources/parser/header_rb.html">
                sources/parser/header.rb
                </a>
        <br />
            </td>
        </tr>

        <tr class="top-aligned-row">
            <td><strong>Parent:</strong></td>
            <td>
                <a href="Object.html">
                Object
               </a>
            </td>
        </tr>
        </table>
    </div>
  <!-- banner header -->

  <div id="bodyContent">



  <div id="contextContent">

    <div id="description">
      <p>
Main class representing a <a href="PDF.html">PDF</a> file and its inner
contents. A <a href="PDF.html">PDF</a> file contains a set of <a
href="PDF/Revision.html">Revision</a>.
</p>

    </div>


   </div>

    <div id="method-list">
      <h3 class="section-bar">Methods</h3>

      <div class="name-list">
      <a href="#M000342">&lt;&lt;</a>&nbsp;&nbsp;
      <a href="#M000366">Catalog</a>&nbsp;&nbsp;
      <a href="#M000367">Catalog=</a>&nbsp;&nbsp;
      <a href="#M000365">add_field</a>&nbsp;&nbsp;
      <a href="#M000348">add_new_revision</a>&nbsp;&nbsp;
      <a href="#M000343">add_to_revision</a>&nbsp;&nbsp;
      <a href="#M000344">alloc_new_object_number</a>&nbsp;&nbsp;
      <a href="#M000372">append_page</a>&nbsp;&nbsp;
      <a href="#M000340">append_subobj</a>&nbsp;&nbsp;
      <a href="#M000352">attach_file</a>&nbsp;&nbsp;
      <a href="#M000345">compile</a>&nbsp;&nbsp;
      <a href="#M000364">create_acroform</a>&nbsp;&nbsp;
      <a href="#M000326">decrypt</a>&nbsp;&nbsp;
      <a href="#M000350">delete_object</a>&nbsp;&nbsp;
      <a href="#M000354">delete_xrefstm</a>&nbsp;&nbsp;
      <a href="#M000360">delinearize!</a>&nbsp;&nbsp;
      <a href="#M000329">deserialize</a>&nbsp;&nbsp;
      <a href="#M000357">enable_usage_rights</a>&nbsp;&nbsp;
      <a href="#M000327">encrypt</a>&nbsp;&nbsp;
      <a href="#M000361">export_to_graph</a>&nbsp;&nbsp;
      <a href="#M000362">export_to_graphml</a>&nbsp;&nbsp;
      <a href="#M000332">filesize</a>&nbsp;&nbsp;
      <a href="#M000338">find</a>&nbsp;&nbsp;
      <a href="#M000378">get_document_info</a>&nbsp;&nbsp;
      <a href="#M000379">get_metadata</a>&nbsp;&nbsp;
      <a href="#M000336">grep</a>&nbsp;&nbsp;
      <a href="#M000376">has_document_info?</a>&nbsp;&nbsp;
      <a href="#M000363">has_form?</a>&nbsp;&nbsp;
      <a href="#M000377">has_metadata?</a>&nbsp;&nbsp;
      <a href="#M000358">has_usage_rights?</a>&nbsp;&nbsp;
      <a href="#M000341">indirect_objects</a>&nbsp;&nbsp;
      <a href="#M000373">insert_page</a>&nbsp;&nbsp;
      <a href="#M000325">is_encrypted?</a>&nbsp;&nbsp;
      <a href="#M000359">is_linearized?</a>&nbsp;&nbsp;
      <a href="#M000356">is_signed?</a>&nbsp;&nbsp;
      <a href="#M000337">ls</a>&nbsp;&nbsp;
      <a href="#M000330">new</a>&nbsp;&nbsp;
      <a href="#M000375">obfuscate_and_saveas</a>&nbsp;&nbsp;
      <a href="#M000339">objects</a>&nbsp;&nbsp;
      <a href="#M000369">onDocumentClose</a>&nbsp;&nbsp;
      <a href="#M000368">onDocumentOpen</a>&nbsp;&nbsp;
      <a href="#M000370">onDocumentPrint</a>&nbsp;&nbsp;
      <a href="#M000374">pages</a>&nbsp;&nbsp;
      <a href="#M000351">physicalize</a>&nbsp;&nbsp;
      <a href="#M000328">read</a>&nbsp;&nbsp;
      <a href="#M000347">rebuildxrefs</a>&nbsp;&nbsp;
      <a href="#M000371">register</a>&nbsp;&nbsp;
      <a href="#M000349">remove_revision</a>&nbsp;&nbsp;
      <a href="#M000353">remove_xrefs</a>&nbsp;&nbsp;
      <a href="#M000333">save</a>&nbsp;&nbsp;
      <a href="#M000335">save_upto</a>&nbsp;&nbsp;
      <a href="#M000334">saveas</a>&nbsp;&nbsp;
      <a href="#M000331">serialize</a>&nbsp;&nbsp;
      <a href="#M000355">sign</a>&nbsp;&nbsp;
      <a href="#M000346">to_bin</a>&nbsp;&nbsp;
      </div>
    </div>

  </div>


    <!-- if includes -->

    <div id="section">

    <div id="class-list">
      <h3 class="section-bar">Classes and Modules</h3>

      Module <a href="PDF/Instruction.html" class="link">Origami::PDF::Instruction</a><br />
Class <a href="PDF/Header.html" class="link">Origami::PDF::Header</a><br />
Class <a href="PDF/Revision.html" class="link">Origami::PDF::Revision</a><br />

    </div>

    <div id="constants-list">
      <h3 class="section-bar">Constants</h3>

      <div class="name-list">
        <table summary="Constants">
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">V</td>
          <td>=</td>
          <td class="context-item-value">version</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">R</td>
          <td>=</td>
          <td class="context-item-value">revision</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">Length</td>
          <td>=</td>
          <td class="context-item-value">params[:KeyLength]</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">P</td>
          <td>=</td>
          <td class="context-item-value">params[:Permissions]</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">EncryptMetadata</td>
          <td>=</td>
          <td class="context-item-value">params[:EncryptMetadata]</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">CF</td>
          <td>=</td>
          <td class="context-item-value">Dictionary.new</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">AuthEvent</td>
          <td>=</td>
          <td class="context-item-value">:DocOpen</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">CFM</td>
          <td>=</td>
          <td class="context-item-value">:AESV2</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">Length</td>
          <td>=</td>
          <td class="context-item-value">params[:KeyLength] &gt;&gt; 3</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">StmF</td>
          <td>=</td>
          <td class="context-item-value">handler.StrF = :StdCF</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">W</td>
          <td>=</td>
          <td class="context-item-value">[ 1, (xrefstm_offset.to_s(2).size + 7) &gt;&gt; 3, 2 ]</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">Prev</td>
          <td>=</td>
          <td class="context-item-value">prev_xref_offset</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">Size</td>
          <td>=</td>
          <td class="context-item-value">objset.size + 1</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">Prev</td>
          <td>=</td>
          <td class="context-item-value">prev_xref_offset</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">XRefStm</td>
          <td>=</td>
          <td class="context-item-value">xrefstm_offset if options[:use_xrefstm] == true</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">Size</td>
          <td>=</td>
          <td class="context-item-value">size + 1</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">Root</td>
          <td>=</td>
          <td class="context-item-value">root</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">Pages</td>
          <td>=</td>
          <td class="context-item-value">PageTreeNode.new.set_indirect(true)</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">Root</td>
          <td>=</td>
          <td class="context-item-value">catalog.reference</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">Size</td>
          <td>=</td>
          <td class="context-item-value">size + 1</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">ID</td>
          <td>=</td>
          <td class="context-item-value">[ id, id ]</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">Rect</td>
          <td>=</td>
          <td class="context-item-value">Rectangle[:llx =&gt; 0.0, :lly =&gt; 0.0, :urx =&gt; 0.0, :ury =&gt; 0.0]</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">V</td>
          <td>=</td>
          <td class="context-item-value">digsig ;</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">SigFlags</td>
          <td>=</td>
          <td class="context-item-value">InteractiveForm::SigFlags::SIGNATURESEXIST | InteractiveForm::SigFlags::APPENDONLY</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">Location</td>
          <td>=</td>
          <td class="context-item-value">HexaString.new(location) if location</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">ContactInfo</td>
          <td>=</td>
          <td class="context-item-value">HexaString.new(contact) if contact</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">Reason</td>
          <td>=</td>
          <td class="context-item-value">HexaString.new(reason) if reason</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">Data</td>
          <td>=</td>
          <td class="context-item-value">self.Catalog</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">TransformParams</td>
          <td>=</td>
          <td class="context-item-value">UsageRights::TransformParams.new</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">V</td>
          <td>=</td>
          <td class="context-item-value">UsageRights::TransformParams::VERSION</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">Reference</td>
          <td>=</td>
          <td class="context-item-value">[ sigref ]</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">UR3</td>
          <td>=</td>
          <td class="context-item-value">digsig</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">Root</td>
          <td>=</td>
          <td class="context-item-value">self &lt;&lt; cat</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">OpenAction</td>
          <td>=</td>
          <td class="context-item-value">action</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">WC</td>
          <td>=</td>
          <td class="context-item-value">action</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">WP</td>
          <td>=</td>
          <td class="context-item-value">action</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">Names</td>
          <td>=</td>
          <td class="context-item-value">Names.new</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">Count</td>
          <td>=</td>
          <td class="context-item-value">treeroot.Kids.length</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">Parent</td>
          <td>=</td>
          <td class="context-item-value">treeroot</td>
        </tr>
        </table>
      </div>
    </div>

    <div id="aliases-list">
      <h3 class="section-bar">External Aliases</h3>

      <div class="name-list">
                        <table summary="aliases">
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">get_object</td>
          <td>-&gt;</td>
          <td class="context-item-value">[]</td>
        </tr>
                        </table>
      </div>
    </div>


    <div id="attribute-list">
      <h3 class="section-bar">Attributes</h3>

      <div class="name-list">
        <table>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">filename</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc"></td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">header</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc"></td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">revisions</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc"></td>
        </tr>
        </table>
      </div>
    </div>
      


    <!-- if method_list -->
    <div id="methods">
      <h3 class="section-bar">Public Class methods</h3>

      <div id="method-M000329" class="method-detail">
        <a name="M000329"></a>

        <div class="method-heading">
          <a href="#M000329" class="method-signature">
          <span class="method-name">deserialize</span><span class="method-args">(filename)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Deserializes a <a href="PDF.html">PDF</a> dump.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000329-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000329-source">
<pre>
     <span class="ruby-comment cmt"># File sources/parser/pdf.rb, line 151</span>
151:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">deserialize</span>(<span class="ruby-identifier">filename</span>)
152:         
153:         <span class="ruby-constant">Zlib</span><span class="ruby-operator">::</span><span class="ruby-constant">GzipReader</span>.<span class="ruby-identifier">open</span>(<span class="ruby-identifier">filename</span>) { <span class="ruby-operator">|</span><span class="ruby-identifier">gz</span><span class="ruby-operator">|</span>
154:           <span class="ruby-identifier">pdf</span> = <span class="ruby-constant">Marshal</span>.<span class="ruby-identifier">load</span>(<span class="ruby-identifier">gz</span>.<span class="ruby-identifier">read</span>)
155:         }
156:         
157:         <span class="ruby-identifier">pdf</span>
158:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000330" class="method-detail">
        <a name="M000330"></a>

        <div class="method-heading">
          <a href="#M000330" class="method-signature">
          <span class="method-name">new</span><span class="method-args">(init_structure = true)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Creates a <a href="PDF.html#M000330">new</a> <a href="PDF.html">PDF</a>
instance.
</p>
<table>
<tr><td valign="top"><em>init_structure</em>:</td><td>If this flag is set, then some structures will be automatically generated
while manipulating this <a href="PDF.html">PDF</a>. Set it if you are
creating a <a href="PDF.html#M000330">new</a> <a href="PDF.html">PDF</a>
file, this <em>must</em> <em>not</em> be used when parsing an existing
file.

</td></tr>
</table>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000330-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000330-source">
<pre>
     <span class="ruby-comment cmt"># File sources/parser/pdf.rb, line 166</span>
166:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-identifier">init_structure</span> = <span class="ruby-keyword kw">true</span>)
167: 
168:       <span class="ruby-ivar">@header</span> = <span class="ruby-constant">PDF</span><span class="ruby-operator">::</span><span class="ruby-constant">Header</span>.<span class="ruby-identifier">new</span>
169:       <span class="ruby-ivar">@revisions</span> = []
170:       
171:       <span class="ruby-identifier">add_new_revision</span>
172:       
173:       <span class="ruby-ivar">@revisions</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">trailer</span> = <span class="ruby-constant">Trailer</span>.<span class="ruby-identifier">new</span>
174: 
175:       <span class="ruby-identifier">init</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">init_structure</span>
176:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000328" class="method-detail">
        <a name="M000328"></a>

        <div class="method-heading">
          <a href="#M000328" class="method-signature">
          <span class="method-name">read</span><span class="method-args">(filename, options = {:verbosity =&gt; Parser::VERBOSE_INSANE})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Read and parse a <a href="PDF.html">PDF</a> file from disk.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000328-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000328-source">
<pre>
     <span class="ruby-comment cmt"># File sources/parser/pdf.rb, line 144</span>
144:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">read</span>(<span class="ruby-identifier">filename</span>, <span class="ruby-identifier">options</span> = {<span class="ruby-identifier">:verbosity</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">Parser</span><span class="ruby-operator">::</span><span class="ruby-constant">VERBOSE_INSANE</span>})
145:         <span class="ruby-constant">Parser</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">options</span>).<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">filename</span>)
146:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <h3 class="section-bar">Public Instance methods</h3>

      <div id="method-M000342" class="method-detail">
        <a name="M000342"></a>

        <div class="method-heading">
          <a href="#M000342" class="method-signature">
          <span class="method-name">&lt;&lt;</span><span class="method-args">(object)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Adds a <a href="PDF.html#M000330">new</a> object to the <a
href="PDF.html">PDF</a> file. If this object has no version number, then a
<a href="PDF.html#M000330">new</a> one will be automatically computed and
assignated to him. It returns a Reference to this <a
href="Object.html">Object</a>.
</p>
<table>
<tr><td valign="top"><em>object</em>:</td><td>The object to add.

</td></tr>
</table>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000342-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000342-source">
<pre>
     <span class="ruby-comment cmt"># File sources/parser/pdf.rb, line 383</span>
383:     <span class="ruby-keyword kw">def</span> <span class="ruby-operator">&lt;&lt;</span>(<span class="ruby-identifier">object</span>)
384:        
385:       <span class="ruby-identifier">add_to_revision</span>(<span class="ruby-identifier">object</span>, <span class="ruby-ivar">@revisions</span>.<span class="ruby-identifier">last</span>)
386:       
387:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000366" class="method-detail">
        <a name="M000366"></a>

        <div class="method-heading">
          <a href="#M000366" class="method-signature">
          <span class="method-name">Catalog</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns the current <a href="PDF.html#M000366">Catalog</a> <a
href="Dictionary.html">Dictionary</a>.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000366-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000366-source">
<pre>
    <span class="ruby-comment cmt"># File sources/parser/catalog.rb, line 33</span>
33:     <span class="ruby-keyword kw">def</span> <span class="ruby-constant">Catalog</span>
34:       <span class="ruby-identifier">get_doc_attr</span>(<span class="ruby-identifier">:Root</span>)
35:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000367" class="method-detail">
        <a name="M000367"></a>

        <div class="method-heading">
          <a href="#M000367" class="method-signature">
          <span class="method-name">Catalog=</span><span class="method-args">(cat)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Sets the current <a href="PDF.html#M000366">Catalog</a> <a
href="Dictionary.html">Dictionary</a>.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000367-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000367-source">
<pre>
    <span class="ruby-comment cmt"># File sources/parser/catalog.rb, line 40</span>
40:     <span class="ruby-keyword kw">def</span> <span class="ruby-constant">Catalog=</span>(<span class="ruby-identifier">cat</span>)
41:       
42:       <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">cat</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Catalog</span>)
43:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">TypeError</span>, <span class="ruby-node">&quot;Expected type Catalog, received #{cat.class}&quot;</span>
44:       <span class="ruby-keyword kw">end</span>
45:       
46:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@revisions</span>.<span class="ruby-identifier">last</span>.<span class="ruby-identifier">trailer</span>.<span class="ruby-constant">Root</span>
47:         <span class="ruby-identifier">delete_object</span>(<span class="ruby-ivar">@revisions</span>.<span class="ruby-identifier">last</span>.<span class="ruby-identifier">trailer</span>.<span class="ruby-constant">Root</span>)
48:       <span class="ruby-keyword kw">end</span>
49:       
50:       <span class="ruby-ivar">@revisions</span>.<span class="ruby-identifier">last</span>.<span class="ruby-identifier">trailer</span>.<span class="ruby-constant">Root</span> = <span class="ruby-keyword kw">self</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">cat</span>
51:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000365" class="method-detail">
        <a name="M000365"></a>

        <div class="method-heading">
          <a href="#M000365" class="method-signature">
          <span class="method-name">add_field</span><span class="method-args">(field)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Add a field to the Acrobat form.
</p>
<table>
<tr><td valign="top"><em>field</em>:</td><td>The <a href="Field.html">Field</a> to add.

</td></tr>
</table>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000365-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000365-source">
<pre>
    <span class="ruby-comment cmt"># File sources/parser/acroform.rb, line 50</span>
50:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">add_field</span>(<span class="ruby-identifier">field</span>)
51:       
52:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">field</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-operator">::</span><span class="ruby-constant">Array</span>)
53:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">TypeError</span>, <span class="ruby-value str">&quot;Expected array of Fields&quot;</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">field</span>.<span class="ruby-identifier">all?</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">f</span><span class="ruby-operator">|</span> <span class="ruby-identifier">f</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Field</span>) }
54:       <span class="ruby-keyword kw">elsif</span> <span class="ruby-keyword kw">not</span> <span class="ruby-identifier">field</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Field</span>)
55:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">TypeError</span>, <span class="ruby-node">&quot;Expected Field, received #{field.class}&quot;</span>
56:       <span class="ruby-keyword kw">end</span>
57:       
58:       <span class="ruby-identifier">fields</span> = <span class="ruby-identifier">field</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Field</span>) <span class="ruby-operator">?</span> [<span class="ruby-identifier">field</span>] <span class="ruby-operator">:</span> <span class="ruby-identifier">field</span>
59:       
60:       <span class="ruby-keyword kw">self</span>.<span class="ruby-constant">Catalog</span>.<span class="ruby-constant">AcroForm</span> <span class="ruby-operator">||=</span> <span class="ruby-constant">InteractiveForm</span>.<span class="ruby-identifier">new</span>
61:       <span class="ruby-keyword kw">self</span>.<span class="ruby-constant">Catalog</span>.<span class="ruby-constant">AcroForm</span>.<span class="ruby-constant">Fields</span> <span class="ruby-operator">||=</span> []
62:       
63:       <span class="ruby-keyword kw">self</span>.<span class="ruby-constant">Catalog</span>.<span class="ruby-constant">AcroForm</span>.<span class="ruby-constant">Fields</span>.<span class="ruby-identifier">concat</span>(<span class="ruby-identifier">fields</span>)
64:       
65:       <span class="ruby-keyword kw">self</span>
66:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000348" class="method-detail">
        <a name="M000348"></a>

        <div class="method-heading">
          <a href="#M000348" class="method-signature">
          <span class="method-name">add_new_revision</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Ends the current <a href="PDF/Revision.html">Revision</a>, and starts a <a
href="PDF.html#M000330">new</a> one.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000348-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000348-source">
<pre>
     <span class="ruby-comment cmt"># File sources/parser/pdf.rb, line 653</span>
653:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">add_new_revision</span>
654:       
655:       <span class="ruby-identifier">root</span> = <span class="ruby-ivar">@revisions</span>.<span class="ruby-identifier">last</span>.<span class="ruby-identifier">trailer</span>[<span class="ruby-identifier">:Root</span>] <span class="ruby-keyword kw">unless</span> <span class="ruby-ivar">@revisions</span>.<span class="ruby-identifier">empty?</span>
656: 
657:       <span class="ruby-ivar">@revisions</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-constant">Revision</span>.<span class="ruby-identifier">new</span>(<span class="ruby-keyword kw">self</span>)
658:       <span class="ruby-ivar">@revisions</span>.<span class="ruby-identifier">last</span>.<span class="ruby-identifier">trailer</span> = <span class="ruby-constant">Trailer</span>.<span class="ruby-identifier">new</span>
659:       <span class="ruby-ivar">@revisions</span>.<span class="ruby-identifier">last</span>.<span class="ruby-identifier">trailer</span>.<span class="ruby-constant">Root</span> = <span class="ruby-identifier">root</span>
660: 
661:       <span class="ruby-keyword kw">self</span>
662:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000343" class="method-detail">
        <a name="M000343"></a>

        <div class="method-heading">
          <a href="#M000343" class="method-signature">
          <span class="method-name">add_to_revision</span><span class="method-args">(object, revision)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Adds a <a href="PDF.html#M000330">new</a> object to a specific revision. If
this object has no version number, then a <a
href="PDF.html#M000330">new</a> one will be automatically computed and
assignated to him. It returns a Reference to this <a
href="Object.html">Object</a>.
</p>
<table>
<tr><td valign="top"><em>object</em>:</td><td>The object to add.

</td></tr>
<tr><td valign="top"><em>revision</em>:</td><td>The revision to add the object to.

</td></tr>
</table>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000343-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000343-source">
<pre>
     <span class="ruby-comment cmt"># File sources/parser/pdf.rb, line 396</span>
396:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">add_to_revision</span>(<span class="ruby-identifier">object</span>, <span class="ruby-identifier">revision</span>)
397:      
398:       <span class="ruby-identifier">object</span>.<span class="ruby-identifier">set_indirect</span>(<span class="ruby-keyword kw">true</span>)
399:       <span class="ruby-identifier">object</span>.<span class="ruby-identifier">set_pdf</span>(<span class="ruby-keyword kw">self</span>)
400:       
401:       <span class="ruby-identifier">object</span>.<span class="ruby-identifier">no</span>, <span class="ruby-identifier">object</span>.<span class="ruby-identifier">generation</span> = <span class="ruby-identifier">alloc_new_object_number</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">object</span>.<span class="ruby-identifier">no</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
402:       
403:       <span class="ruby-identifier">revision</span>.<span class="ruby-identifier">body</span>[<span class="ruby-identifier">object</span>.<span class="ruby-identifier">reference</span>] = <span class="ruby-identifier">object</span>
404:       
405:       <span class="ruby-identifier">object</span>.<span class="ruby-identifier">reference</span>
406:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000344" class="method-detail">
        <a name="M000344"></a>

        <div class="method-heading">
          <a href="#M000344" class="method-signature">
          <span class="method-name">alloc_new_object_number</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns a <a href="PDF.html#M000330">new</a> number/generation for future
object.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000344-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000344-source">
<pre>
     <span class="ruby-comment cmt"># File sources/parser/pdf.rb, line 411</span>
411:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">alloc_new_object_number</span>
412:       
413:       <span class="ruby-identifier">no</span> = <span class="ruby-value">1</span>
414:       <span class="ruby-identifier">no</span> = <span class="ruby-identifier">no</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span> <span class="ruby-keyword kw">while</span> <span class="ruby-identifier">get_object</span>(<span class="ruby-identifier">no</span>)
415: 
416:       <span class="ruby-identifier">objset</span> = <span class="ruby-identifier">indirect_objects</span>
417: 
418:       <span class="ruby-identifier">no</span> = 
419:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">objset</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span> <span class="ruby-keyword kw">then</span> <span class="ruby-value">1</span>
420:       <span class="ruby-keyword kw">else</span> 
421:         <span class="ruby-identifier">indirect_objects</span>.<span class="ruby-identifier">keys</span>.<span class="ruby-identifier">max</span>.<span class="ruby-identifier">refno</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>
422:       <span class="ruby-keyword kw">end</span>
423: 
424:       [ <span class="ruby-identifier">no</span>, <span class="ruby-value">0</span> ]
425:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000372" class="method-detail">
        <a name="M000372"></a>

        <div class="method-heading">
          <a href="#M000372" class="method-signature">
          <span class="method-name">append_page</span><span class="method-args">(page = Page.new, *more)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000372-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000372-source">
<pre>
    <span class="ruby-comment cmt"># File sources/parser/page.rb, line 26</span>
26:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">append_page</span>(<span class="ruby-identifier">page</span> = <span class="ruby-constant">Page</span>.<span class="ruby-identifier">new</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">more</span>)
27:     
28:       <span class="ruby-identifier">pages</span> = [ <span class="ruby-identifier">page</span> ].<span class="ruby-identifier">concat</span>(<span class="ruby-identifier">more</span>)
29:       
30:       <span class="ruby-identifier">fail</span> <span class="ruby-node">&quot;Expecting Page type, instead of #{page.class}&quot;</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">pages</span>.<span class="ruby-identifier">all?</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">page</span><span class="ruby-operator">|</span> <span class="ruby-identifier">page</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Page</span>)}
31:       
32:       <span class="ruby-identifier">treeroot</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-constant">Catalog</span>.<span class="ruby-constant">Pages</span>
33:       
34:       <span class="ruby-identifier">treeroot</span>.<span class="ruby-constant">Kids</span> <span class="ruby-operator">||=</span> [] <span class="ruby-comment cmt">#:nodoc:</span>
35:       <span class="ruby-identifier">treeroot</span>.<span class="ruby-constant">Kids</span>.<span class="ruby-identifier">concat</span>(<span class="ruby-identifier">pages</span>)
36:       <span class="ruby-identifier">treeroot</span>.<span class="ruby-constant">Count</span> = <span class="ruby-identifier">treeroot</span>.<span class="ruby-constant">Kids</span>.<span class="ruby-identifier">length</span>
37:       
38:       <span class="ruby-identifier">pages</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">page</span><span class="ruby-operator">|</span> 
39:         <span class="ruby-identifier">page</span>.<span class="ruby-constant">Parent</span> = <span class="ruby-identifier">treeroot</span>
40:       <span class="ruby-keyword kw">end</span>
41:       
42:       <span class="ruby-keyword kw">self</span>
43:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000340" class="method-detail">
        <a name="M000340"></a>

        <div class="method-heading">
          <a href="#M000340" class="method-signature">
          <span class="method-name">append_subobj</span><span class="method-args">(root, objset, inc_objstm)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000340-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000340-source">
<pre>
     <span class="ruby-comment cmt"># File sources/parser/pdf.rb, line 330</span>
330:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">append_subobj</span>(<span class="ruby-identifier">root</span>, <span class="ruby-identifier">objset</span>, <span class="ruby-identifier">inc_objstm</span>)
331:         
332:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">objset</span>.<span class="ruby-identifier">find</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">o</span><span class="ruby-operator">|</span> <span class="ruby-identifier">root</span>.<span class="ruby-identifier">equal?</span>(<span class="ruby-identifier">o</span>) }.<span class="ruby-identifier">nil?</span>
333:           
334:           <span class="ruby-identifier">objset</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">root</span>
335: 
336:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">root</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Dictionary</span>)
337:             <span class="ruby-identifier">root</span>.<span class="ruby-identifier">each_pair</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">name</span>, <span class="ruby-identifier">value</span><span class="ruby-operator">|</span>
338:               <span class="ruby-identifier">append_subobj</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">objset</span>, <span class="ruby-identifier">inc_objstm</span>)
339:               <span class="ruby-identifier">append_subobj</span>(<span class="ruby-identifier">value</span>, <span class="ruby-identifier">objset</span>, <span class="ruby-identifier">inc_objstm</span>)
340:             }
341:           <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">root</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Array</span>) <span class="ruby-keyword kw">or</span> (<span class="ruby-identifier">root</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">ObjectStream</span>) <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">inc_objstm</span> <span class="ruby-operator">==</span> <span class="ruby-keyword kw">true</span>)
342:             <span class="ruby-identifier">root</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">subobj</span><span class="ruby-operator">|</span> <span class="ruby-identifier">append_subobj</span>(<span class="ruby-identifier">subobj</span>, <span class="ruby-identifier">objset</span>, <span class="ruby-identifier">inc_objstm</span>) }
343:           <span class="ruby-keyword kw">end</span>
344:         
345:         <span class="ruby-keyword kw">end</span>
346:         
347:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000352" class="method-detail">
        <a name="M000352"></a>

        <div class="method-heading">
          <a href="#M000352" class="method-signature">
          <span class="method-name">attach_file</span><span class="method-args">(path, options = {})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Attachs an embedded file to the <a href="PDF.html">PDF</a>.
</p>
<table>
<tr><td valign="top"><em>path</em>:</td><td>The path to the file to attach.

</td></tr>
<tr><td valign="top"><em>options</em>:</td><td>A set of options to configure the attachment.

</td></tr>
</table>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000352-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000352-source">
<pre>
    <span class="ruby-comment cmt"># File sources/parser/file.rb, line 35</span>
35:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">attach_file</span>(<span class="ruby-identifier">path</span>, <span class="ruby-identifier">options</span> = {})
36: 
37:       <span class="ruby-comment cmt">#</span>
38:       <span class="ruby-comment cmt"># Default options.</span>
39:       <span class="ruby-comment cmt">#</span>
40:       <span class="ruby-identifier">params</span> = 
41:       {
42:         <span class="ruby-identifier">:Register</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span>,                      <span class="ruby-comment cmt"># Shall the file be registered in the name directory ?</span>
43:         <span class="ruby-identifier">:EmbeddedName</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">basename</span>(<span class="ruby-identifier">path</span>),   <span class="ruby-comment cmt"># The inner filename of the attachment.</span>
44:         <span class="ruby-identifier">:Filter</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:FlateDecode</span>                 <span class="ruby-comment cmt"># The stream filter used to store data.</span>
45:       }
46: 
47:       <span class="ruby-identifier">params</span>.<span class="ruby-identifier">update</span>(<span class="ruby-identifier">options</span>)
48:       
49:       <span class="ruby-identifier">fdata</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">open</span>(<span class="ruby-identifier">path</span>, <span class="ruby-value str">&quot;r&quot;</span>).<span class="ruby-identifier">binmode</span>.<span class="ruby-identifier">read</span>
50:       
51:       <span class="ruby-identifier">fstream</span> = <span class="ruby-constant">EmbeddedFileStream</span>.<span class="ruby-identifier">new</span>
52:       <span class="ruby-identifier">fstream</span>.<span class="ruby-identifier">data</span> = <span class="ruby-identifier">fdata</span>
53:       <span class="ruby-identifier">fstream</span>.<span class="ruby-identifier">setFilter</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:Filter</span>])
54:       
55:       <span class="ruby-identifier">name</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:EmbeddedName</span>]
56:       <span class="ruby-identifier">fspec</span> = <span class="ruby-constant">FileSpec</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">setType</span>(<span class="ruby-identifier">:Filespec</span>).<span class="ruby-identifier">setF</span>(<span class="ruby-identifier">name</span>).<span class="ruby-identifier">setEF</span>(<span class="ruby-constant">FileSpec</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">:F</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">fstream</span>))
57:       
58:       <span class="ruby-identifier">register</span>(<span class="ruby-constant">Names</span><span class="ruby-operator">::</span><span class="ruby-constant">Root</span><span class="ruby-operator">::</span><span class="ruby-constant">EMBEDDEDFILES</span>, <span class="ruby-identifier">name</span>, <span class="ruby-identifier">fspec</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:Register</span>] <span class="ruby-operator">==</span> <span class="ruby-keyword kw">true</span>
59: 
60:       <span class="ruby-identifier">fspec</span>
61:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000345" class="method-detail">
        <a name="M000345"></a>

        <div class="method-heading">
          <a href="#M000345" class="method-signature">
          <span class="method-name">compile</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
This method is meant to recompute, verify and correct main <a
href="PDF.html">PDF</a> structures, in order to output a proper file.
</p>
<ul>
<li>Allocates <a href="PDF.html#M000339">objects</a> references.

</li>
<li>Sets some <a href="PDF.html#M000339">objects</a> missing required values.

</li>
</ul>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000345-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000345-source">
<pre>
     <span class="ruby-comment cmt"># File sources/parser/pdf.rb, line 432</span>
432:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">compile</span>
433:       
434:       <span class="ruby-comment cmt">#</span>
435:       <span class="ruby-comment cmt"># A valid document must have at least one page.</span>
436:       <span class="ruby-comment cmt">#</span>
437:       <span class="ruby-identifier">append_page</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">pages</span>.<span class="ruby-identifier">empty?</span>
438:      
439:       <span class="ruby-comment cmt">#</span>
440:       <span class="ruby-comment cmt"># Allocates object numbers and creates references.</span>
441:       <span class="ruby-comment cmt"># Invokes object finalization methods.</span>
442:       <span class="ruby-comment cmt">#</span>
443:       <span class="ruby-identifier">physicalize</span>
444:             
445:       <span class="ruby-comment cmt">#</span>
446:       <span class="ruby-comment cmt"># Sets the PDF version header.</span>
447:       <span class="ruby-comment cmt">#</span>
448:       <span class="ruby-identifier">pdf_version</span> = <span class="ruby-identifier">version_required</span>
449:       <span class="ruby-ivar">@header</span>.<span class="ruby-identifier">majorversion</span> = <span class="ruby-identifier">pdf_version</span>.<span class="ruby-identifier">to_s</span>[<span class="ruby-value">0</span>,<span class="ruby-value">1</span>].<span class="ruby-identifier">to_i</span>
450:       <span class="ruby-ivar">@header</span>.<span class="ruby-identifier">minorversion</span> = <span class="ruby-identifier">pdf_version</span>.<span class="ruby-identifier">to_s</span>[<span class="ruby-value">2</span>,<span class="ruby-value">1</span>].<span class="ruby-identifier">to_i</span>
451:       
452:       <span class="ruby-keyword kw">self</span>
453:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000364" class="method-detail">
        <a name="M000364"></a>

        <div class="method-heading">
          <a href="#M000364" class="method-signature">
          <span class="method-name">create_acroform</span><span class="method-args">(*fields)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000364-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000364-source">
<pre>
    <span class="ruby-comment cmt"># File sources/parser/acroform.rb, line 37</span>
37:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">create_acroform</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">fields</span>)
38:       <span class="ruby-identifier">acroform</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-constant">Catalog</span>.<span class="ruby-constant">AcroForm</span> <span class="ruby-operator">||=</span> <span class="ruby-constant">InteractiveForm</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">set_indirect</span>(<span class="ruby-keyword kw">true</span>)
39: 
40:       <span class="ruby-identifier">acroform</span>.<span class="ruby-constant">Fields</span> <span class="ruby-operator">||=</span> []
41:       <span class="ruby-identifier">acroform</span>.<span class="ruby-constant">Fields</span>.<span class="ruby-identifier">concat</span>(<span class="ruby-identifier">fields</span>)
42: 
43:       <span class="ruby-identifier">acroform</span>
44:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000326" class="method-detail">
        <a name="M000326"></a>

        <div class="method-heading">
          <a href="#M000326" class="method-signature">
          <span class="method-name">decrypt</span><span class="method-args">(passwd = &quot;&quot;)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Decrypts the current document (only RC4 40..128 bits). TODO: AESv2, AESv3,
lazy decryption
</p>
<table>
<tr><td valign="top"><em>passwd</em>:</td><td>The password to <a href="PDF.html#M000326">decrypt</a> the document.

</td></tr>
</table>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000326-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000326-source">
<pre>
     <span class="ruby-comment cmt"># File sources/parser/encryption.rb, line 54</span>
 54:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">decrypt</span>(<span class="ruby-identifier">passwd</span> = <span class="ruby-value str">&quot;&quot;</span>)
 55:     
 56:       <span class="ruby-keyword kw">unless</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">is_encrypted?</span>
 57:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">EncryptionError</span>, <span class="ruby-value str">&quot;PDF is not encrypted&quot;</span>
 58:       <span class="ruby-keyword kw">end</span>
 59:      
 60:       <span class="ruby-identifier">encrypt_dict</span> = <span class="ruby-identifier">get_doc_attr</span>(<span class="ruby-identifier">:Encrypt</span>)
 61:       <span class="ruby-identifier">handler</span> = <span class="ruby-constant">Encryption</span><span class="ruby-operator">::</span><span class="ruby-constant">Standard</span><span class="ruby-operator">::</span><span class="ruby-constant">Dictionary</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">encrypt_dict</span>.<span class="ruby-identifier">copy</span>)
 62: 
 63:       <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">handler</span>.<span class="ruby-constant">Filter</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">:Standard</span>
 64:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">EncryptionNotSupportedError</span>, <span class="ruby-node">&quot;Unknown security handler : '#{handler.Filter.to_s}'&quot;</span>
 65:       <span class="ruby-keyword kw">end</span>
 66: 
 67:       <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">handler</span>.<span class="ruby-constant">V</span>.<span class="ruby-identifier">to_i</span>
 68:         <span class="ruby-keyword kw">when</span> <span class="ruby-value">1</span>,<span class="ruby-value">2</span> <span class="ruby-keyword kw">then</span> <span class="ruby-identifier">str_algo</span> = <span class="ruby-identifier">stm_algo</span> = <span class="ruby-constant">Encryption</span><span class="ruby-operator">::</span><span class="ruby-constant">ARC4</span>
 69:         <span class="ruby-keyword kw">when</span> <span class="ruby-value">4</span>
 70:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">handler</span>[<span class="ruby-identifier">:CF</span>].<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Dictionary</span>)
 71:             <span class="ruby-identifier">cfs</span> = <span class="ruby-identifier">handler</span>[<span class="ruby-identifier">:CF</span>]
 72:             
 73:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">handler</span>[<span class="ruby-identifier">:StrF</span>].<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Name</span>) <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">cfs</span>[<span class="ruby-identifier">handler</span>[<span class="ruby-identifier">:StrF</span>]].<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Dictionary</span>)
 74:               <span class="ruby-identifier">cfdict</span> = <span class="ruby-identifier">cfs</span>[<span class="ruby-identifier">handler</span>[<span class="ruby-identifier">:StrF</span>]]
 75:               
 76:               <span class="ruby-identifier">str_algo</span> =
 77:               <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">cfdict</span>[<span class="ruby-identifier">:CFM</span>] <span class="ruby-operator">==</span> <span class="ruby-identifier">:V2</span> <span class="ruby-keyword kw">then</span> <span class="ruby-constant">Encryption</span><span class="ruby-operator">::</span><span class="ruby-constant">ARC4</span>
 78:               <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">cfdict</span>[<span class="ruby-identifier">:CFM</span>] <span class="ruby-operator">==</span> <span class="ruby-identifier">:AESV2</span> <span class="ruby-keyword kw">then</span> <span class="ruby-constant">Encryption</span><span class="ruby-operator">::</span><span class="ruby-constant">AES</span>
 79:               <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">cfdict</span>[<span class="ruby-identifier">:CFM</span>] <span class="ruby-operator">==</span> <span class="ruby-identifier">:None</span> <span class="ruby-keyword kw">then</span> <span class="ruby-constant">Encryption</span><span class="ruby-operator">::</span><span class="ruby-constant">Identity</span>
 80:               <span class="ruby-keyword kw">else</span>
 81:                 <span class="ruby-constant">Encryption</span><span class="ruby-operator">::</span><span class="ruby-constant">Identity</span>
 82:               <span class="ruby-keyword kw">end</span>
 83:             <span class="ruby-keyword kw">else</span>
 84:               <span class="ruby-identifier">str_algo</span> = <span class="ruby-constant">Encryption</span><span class="ruby-operator">::</span><span class="ruby-constant">Identity</span>
 85:             <span class="ruby-keyword kw">end</span>
 86: 
 87:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">handler</span>[<span class="ruby-identifier">:StmF</span>].<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Name</span>) <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">cfs</span>[<span class="ruby-identifier">handler</span>[<span class="ruby-identifier">:StmF</span>]].<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Dictionary</span>)
 88:               <span class="ruby-identifier">cfdict</span> = <span class="ruby-identifier">cfs</span>[<span class="ruby-identifier">handler</span>[<span class="ruby-identifier">:StmF</span>]]
 89: 
 90:               <span class="ruby-identifier">stm_algo</span> =
 91:               <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">cfdict</span>[<span class="ruby-identifier">:CFM</span>] <span class="ruby-operator">==</span> <span class="ruby-identifier">:V2</span> <span class="ruby-keyword kw">then</span> <span class="ruby-constant">Encryption</span><span class="ruby-operator">::</span><span class="ruby-constant">ARC4</span>
 92:               <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">cfdict</span>[<span class="ruby-identifier">:CFM</span>] <span class="ruby-operator">==</span> <span class="ruby-identifier">:AESV2</span> <span class="ruby-keyword kw">then</span> <span class="ruby-constant">Encryption</span><span class="ruby-operator">::</span><span class="ruby-constant">AES</span>
 93:               <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">cfdict</span>[<span class="ruby-identifier">:CFM</span>] <span class="ruby-operator">==</span> <span class="ruby-identifier">:None</span> <span class="ruby-keyword kw">then</span> <span class="ruby-constant">Encryption</span><span class="ruby-operator">::</span><span class="ruby-constant">Identity</span>
 94:               <span class="ruby-keyword kw">else</span>
 95:                 <span class="ruby-constant">Encryption</span><span class="ruby-operator">::</span><span class="ruby-constant">Identity</span>
 96:               <span class="ruby-keyword kw">end</span>
 97:             <span class="ruby-keyword kw">else</span>
 98:               <span class="ruby-identifier">stm_algo</span> = <span class="ruby-constant">Encryption</span><span class="ruby-operator">::</span><span class="ruby-constant">Identity</span>
 99:             <span class="ruby-keyword kw">end</span>
100: 
101:           <span class="ruby-keyword kw">else</span>
102:             <span class="ruby-identifier">str_algo</span> = <span class="ruby-identifier">stm_algo</span> = <span class="ruby-constant">Encryption</span><span class="ruby-operator">::</span><span class="ruby-constant">Identity</span>
103:           <span class="ruby-keyword kw">end</span>
104:       <span class="ruby-keyword kw">else</span>
105:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">EncryptionNotSupportedError</span>, <span class="ruby-node">&quot;Unsupported encryption version : #{handler.V}&quot;</span>
106:       <span class="ruby-keyword kw">end</span>
107: 
108:       <span class="ruby-identifier">id</span> = <span class="ruby-identifier">get_doc_attr</span>(<span class="ruby-identifier">:ID</span>)
109:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">id</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-keyword kw">or</span> <span class="ruby-keyword kw">not</span> <span class="ruby-identifier">id</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Array</span>)
110:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">EncryptionError</span>, <span class="ruby-value str">&quot;Document ID was not found or is invalid&quot;</span>
111:       <span class="ruby-keyword kw">else</span>
112:         <span class="ruby-identifier">id</span> = <span class="ruby-identifier">id</span>.<span class="ruby-identifier">first</span>
113:       <span class="ruby-keyword kw">end</span>
114: 
115:       <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">not</span> <span class="ruby-identifier">handler</span>.<span class="ruby-identifier">is_owner_password?</span>(<span class="ruby-identifier">passwd</span>, <span class="ruby-identifier">id</span>) <span class="ruby-keyword kw">and</span> <span class="ruby-keyword kw">not</span> <span class="ruby-identifier">handler</span>.<span class="ruby-identifier">is_user_password?</span>(<span class="ruby-identifier">passwd</span>, <span class="ruby-identifier">id</span>)
116:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">EncryptionInvalidPasswordError</span>
117:       <span class="ruby-keyword kw">end</span>
118: 
119:       <span class="ruby-identifier">encryption_key</span> = <span class="ruby-identifier">handler</span>.<span class="ruby-identifier">compute_encryption_key</span>(<span class="ruby-identifier">passwd</span>, <span class="ruby-identifier">id</span>)
120: 
121:       <span class="ruby-comment cmt">#self.extend(Encryption::EncryptedDocument)</span>
122:       <span class="ruby-comment cmt">#self.encryption_dict = encrypt_dict</span>
123:       <span class="ruby-comment cmt">#self.encryption_key = encryption_key</span>
124:       <span class="ruby-comment cmt">#self.stm_algo = self.str_algo = algorithm</span>
125: 
126:       <span class="ruby-identifier">encrypt_metadata</span> = (<span class="ruby-identifier">handler</span>.<span class="ruby-constant">EncryptMetadata</span> <span class="ruby-operator">!=</span> <span class="ruby-keyword kw">false</span>)
127:       <span class="ruby-comment cmt">#</span>
128:       <span class="ruby-comment cmt"># Should be fixed to exclude only the active XRefStream</span>
129:       <span class="ruby-comment cmt">#</span>
130:       <span class="ruby-identifier">encrypted_objects</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">objects</span>(<span class="ruby-keyword kw">false</span>).<span class="ruby-identifier">find_all</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">obj</span><span class="ruby-operator">|</span>
131: 
132:         (<span class="ruby-identifier">obj</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">String</span>) <span class="ruby-keyword kw">and</span> 
133:           <span class="ruby-keyword kw">not</span> <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">indirect_parent</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">XRefStream</span>) <span class="ruby-keyword kw">and</span> 
134:           <span class="ruby-keyword kw">not</span> <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">equal?</span>(<span class="ruby-identifier">encrypt_dict</span>[<span class="ruby-identifier">:U</span>]) <span class="ruby-keyword kw">and</span> 
135:           <span class="ruby-keyword kw">not</span> <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">equal?</span>(<span class="ruby-identifier">encrypt_dict</span>[<span class="ruby-identifier">:O</span>])) <span class="ruby-keyword kw">or</span> 
136:         
137:         (<span class="ruby-identifier">obj</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Stream</span>) <span class="ruby-keyword kw">and</span> 
138:           <span class="ruby-keyword kw">not</span> <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">XRefStream</span>) <span class="ruby-keyword kw">and</span>
139:           (<span class="ruby-keyword kw">not</span> <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">equal?</span>(<span class="ruby-keyword kw">self</span>.<span class="ruby-constant">Catalog</span>.<span class="ruby-constant">Metadata</span>) <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">encrypt_metadata</span>))
140:       }
141:      
142:       <span class="ruby-identifier">encrypted_objects</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">obj</span><span class="ruby-operator">|</span>
143:         <span class="ruby-identifier">no</span> = <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">indirect_parent</span>.<span class="ruby-identifier">no</span>
144:         <span class="ruby-identifier">gen</span> = <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">indirect_parent</span>.<span class="ruby-identifier">generation</span>
145: 
146:         <span class="ruby-identifier">k</span> = <span class="ruby-identifier">encryption_key</span> <span class="ruby-operator">+</span> [<span class="ruby-identifier">no</span>].<span class="ruby-identifier">pack</span>(<span class="ruby-value str">&quot;I&quot;</span>)[<span class="ruby-value">0</span><span class="ruby-operator">..</span><span class="ruby-value">2</span>] <span class="ruby-operator">+</span> [<span class="ruby-identifier">gen</span>].<span class="ruby-identifier">pack</span>(<span class="ruby-value str">&quot;I&quot;</span>)[<span class="ruby-value">0</span><span class="ruby-operator">..</span><span class="ruby-value">1</span>]
147:         <span class="ruby-identifier">key_len</span> = (<span class="ruby-identifier">k</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">16</span>) <span class="ruby-operator">?</span> <span class="ruby-value">16</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">k</span>.<span class="ruby-identifier">length</span>
148: 
149:         <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">obj</span>
150:           <span class="ruby-keyword kw">when</span> <span class="ruby-constant">String</span>
151:             <span class="ruby-identifier">k</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot;sAlT&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">str_algo</span> <span class="ruby-operator">==</span> <span class="ruby-constant">Encryption</span><span class="ruby-operator">::</span><span class="ruby-constant">AES</span>
152:           <span class="ruby-keyword kw">when</span> <span class="ruby-constant">Stream</span>
153:             <span class="ruby-identifier">k</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot;sAlT&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">stm_algo</span> <span class="ruby-operator">==</span> <span class="ruby-constant">Encryption</span><span class="ruby-operator">::</span><span class="ruby-constant">AES</span>
154:         <span class="ruby-keyword kw">end</span>
155: 
156:         <span class="ruby-identifier">key</span> = <span class="ruby-constant">Digest</span><span class="ruby-operator">::</span><span class="ruby-constant">MD5</span>.<span class="ruby-identifier">digest</span>(<span class="ruby-identifier">k</span>)[<span class="ruby-value">0</span>, <span class="ruby-identifier">key_len</span>]
157: 
158:         <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">obj</span>
159:           <span class="ruby-keyword kw">when</span> <span class="ruby-constant">String</span> <span class="ruby-keyword kw">then</span> <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">replace</span>(<span class="ruby-identifier">str_algo</span>.<span class="ruby-identifier">decrypt</span>(<span class="ruby-identifier">key</span>, <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">value</span>))
160:           <span class="ruby-keyword kw">when</span> <span class="ruby-constant">Stream</span> <span class="ruby-keyword kw">then</span> <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">rawdata</span> = <span class="ruby-identifier">stm_algo</span>.<span class="ruby-identifier">decrypt</span>(<span class="ruby-identifier">key</span>, <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">rawdata</span>) 
161:         <span class="ruby-keyword kw">end</span>
162:       }
163: 
164:       <span class="ruby-keyword kw">self</span>
165:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000350" class="method-detail">
        <a name="M000350"></a>

        <div class="method-heading">
          <a href="#M000350" class="method-signature">
          <span class="method-name">delete_object</span><span class="method-args">(no, generation = 0)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Remove an object.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000350-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000350-source">
<pre>
     <span class="ruby-comment cmt"># File sources/parser/pdf.rb, line 691</span>
691:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">delete_object</span>(<span class="ruby-identifier">no</span>, <span class="ruby-identifier">generation</span> = <span class="ruby-value">0</span>)
692:       
693:       <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">no</span>
694:         <span class="ruby-keyword kw">when</span> <span class="ruby-constant">Reference</span>
695:           <span class="ruby-identifier">target</span> = <span class="ruby-identifier">no</span>
696:         <span class="ruby-keyword kw">when</span> <span class="ruby-operator">::</span><span class="ruby-constant">Integer</span>
697:           <span class="ruby-identifier">target</span> = <span class="ruby-constant">Reference</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">no</span>, <span class="ruby-identifier">generation</span>)
698:       <span class="ruby-keyword kw">else</span>
699:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">TypeError</span>, <span class="ruby-node">&quot;Invalid parameter type : #{no.class}&quot;</span> 
700:       <span class="ruby-keyword kw">end</span>
701:       
702:       <span class="ruby-ivar">@revisions</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">rev</span><span class="ruby-operator">|</span>
703:         <span class="ruby-identifier">rev</span>.<span class="ruby-identifier">body</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">target</span>)
704:       <span class="ruby-keyword kw">end</span>
705: 
706:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000354" class="method-detail">
        <a name="M000354"></a>

        <div class="method-heading">
          <a href="#M000354" class="method-signature">
          <span class="method-name">delete_xrefstm</span><span class="method-args">(xrefstm)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000354-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000354-source">
<pre>
    <span class="ruby-comment cmt"># File sources/parser/xreftable.rb, line 30</span>
30:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">delete_xrefstm</span>(<span class="ruby-identifier">xrefstm</span>)
31:         <span class="ruby-identifier">prev</span> = <span class="ruby-identifier">xrefstm</span>.<span class="ruby-constant">Prev</span>
32:         <span class="ruby-identifier">delete_object</span>(<span class="ruby-identifier">xrefstm</span>.<span class="ruby-identifier">reference</span>)
33: 
34:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">prev</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Integer</span>) <span class="ruby-keyword kw">and</span> (<span class="ruby-identifier">prev_stm</span> = <span class="ruby-identifier">get_object_by_offset</span>(<span class="ruby-identifier">prev</span>)).<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">XRefStream</span>)
35:           <span class="ruby-identifier">delete_xrefstm</span>(<span class="ruby-identifier">prev_stm</span>)
36:         <span class="ruby-keyword kw">end</span>
37:       <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000360" class="method-detail">
        <a name="M000360"></a>

        <div class="method-heading">
          <a href="#M000360" class="method-signature">
          <span class="method-name">delinearize!</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Tries to delinearize the document if it has been linearized. This operation
is xrefs destructive, should be fixed in the future to merge tables.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000360-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000360-source">
<pre>
    <span class="ruby-comment cmt"># File sources/parser/linearization.rb, line 43</span>
43:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">delinearize!</span>
44:       <span class="ruby-identifier">raise</span> <span class="ruby-constant">InvalidPDF</span>, <span class="ruby-value str">'Not a linearized document'</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">is_linearized?</span>
45:       
46:       <span class="ruby-comment cmt">#</span>
47:       <span class="ruby-comment cmt"># Saves the catalog location.</span>
48:       <span class="ruby-comment cmt">#</span>
49:       <span class="ruby-identifier">catalog_ref</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-constant">Catalog</span>.<span class="ruby-identifier">reference</span>
50: 
51:       <span class="ruby-identifier">lin_dict</span> = <span class="ruby-ivar">@revisions</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">body</span>.<span class="ruby-identifier">values</span>.<span class="ruby-identifier">first</span>
52:       <span class="ruby-identifier">hints</span> = <span class="ruby-identifier">lin_dict</span>[<span class="ruby-identifier">:H</span>]
53:   
54:       <span class="ruby-comment cmt">#</span>
55:       <span class="ruby-comment cmt"># Removes hint streams used by linearization.</span>
56:       <span class="ruby-comment cmt">#</span>
57:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">hints</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-operator">::</span><span class="ruby-constant">Array</span>)
58:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">hints</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">hints</span>[<span class="ruby-value">0</span>].<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Integer</span>)
59:           <span class="ruby-identifier">hint_stream</span> = <span class="ruby-identifier">get_object_by_offset</span>(<span class="ruby-identifier">hints</span>[<span class="ruby-value">0</span>])
60:           <span class="ruby-identifier">delete_object</span>(<span class="ruby-identifier">hint_stream</span>.<span class="ruby-identifier">reference</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">hint_stream</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Stream</span>)
61:         <span class="ruby-keyword kw">end</span>
62: 
63:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">hints</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">2</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">hints</span>[<span class="ruby-value">2</span>].<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Integer</span>)
64:           <span class="ruby-identifier">overflow_stream</span> = <span class="ruby-identifier">get_object_by_offset</span>(<span class="ruby-identifier">hints</span>[<span class="ruby-value">2</span>])
65:           <span class="ruby-identifier">delete_object</span>(<span class="ruby-identifier">overflow_stream</span>.<span class="ruby-identifier">reference</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">overflow_stream</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Stream</span>)
66:         <span class="ruby-keyword kw">end</span>
67:       <span class="ruby-keyword kw">end</span>
68: 
69:       <span class="ruby-comment cmt">#</span>
70:       <span class="ruby-comment cmt"># Should be merged instead.</span>
71:       <span class="ruby-comment cmt">#</span>
72:       <span class="ruby-identifier">remove_xrefs</span>
73: 
74:       <span class="ruby-comment cmt">#</span>
75:       <span class="ruby-comment cmt"># Remove the linearization revision.</span>
76:       <span class="ruby-comment cmt">#</span>
77:       <span class="ruby-identifier">remove_revision</span>(<span class="ruby-value">0</span>)
78: 
79:       <span class="ruby-comment cmt">#</span>
80:       <span class="ruby-comment cmt"># Restore the Catalog.</span>
81:       <span class="ruby-comment cmt">#</span>
82:       <span class="ruby-ivar">@revisions</span>.<span class="ruby-identifier">last</span>.<span class="ruby-identifier">trailer</span> <span class="ruby-operator">||=</span> <span class="ruby-constant">Trailer</span>.<span class="ruby-identifier">new</span>
83:       <span class="ruby-ivar">@revisions</span>.<span class="ruby-identifier">last</span>.<span class="ruby-identifier">trailer</span>.<span class="ruby-identifier">dictionary</span>[<span class="ruby-identifier">:Root</span>] = <span class="ruby-identifier">catalog_ref</span>
84: 
85:       <span class="ruby-keyword kw">self</span>
86:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000357" class="method-detail">
        <a name="M000357"></a>

        <div class="method-heading">
          <a href="#M000357" class="method-signature">
          <span class="method-name">enable_usage_rights</span><span class="method-args">(*rights)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Enable the document Usage Rights.
</p>
<table>
<tr><td valign="top"><em>rights</em>:</td><td>list of rights defined in <a
href="UsageRights/Rights.html">UsageRights::Rights</a>

</td></tr>
</table>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000357-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000357-source">
<pre>
     <span class="ruby-comment cmt"># File sources/parser/signature.rb, line 130</span>
130:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">enable_usage_rights</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">rights</span>)
131:       
132:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">signfield_size</span>(<span class="ruby-identifier">certificate</span>, <span class="ruby-identifier">key</span>, <span class="ruby-identifier">ca</span> = []) <span class="ruby-comment cmt">#:nodoc:</span>
133:         <span class="ruby-identifier">datatest</span> = <span class="ruby-value str">&quot;abcdefghijklmnopqrstuvwxyz&quot;</span>
134:         <span class="ruby-constant">OpenSSL</span><span class="ruby-operator">::</span><span class="ruby-constant">PKCS7</span>.<span class="ruby-identifier">sign</span>(<span class="ruby-identifier">certificate</span>, <span class="ruby-identifier">key</span>, <span class="ruby-identifier">datatest</span>, <span class="ruby-identifier">ca</span>, <span class="ruby-constant">OpenSSL</span><span class="ruby-operator">::</span><span class="ruby-constant">PKCS7</span><span class="ruby-operator">::</span><span class="ruby-constant">DETACHED</span> <span class="ruby-operator">|</span> <span class="ruby-constant">OpenSSL</span><span class="ruby-operator">::</span><span class="ruby-constant">PKCS7</span><span class="ruby-operator">::</span><span class="ruby-constant">BINARY</span>).<span class="ruby-identifier">to_der</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">+</span> <span class="ruby-value">128</span>
135:       <span class="ruby-keyword kw">end</span>
136:       
137:       <span class="ruby-keyword kw">begin</span>
138:         <span class="ruby-identifier">key</span> = <span class="ruby-constant">OpenSSL</span><span class="ruby-operator">::</span><span class="ruby-constant">PKey</span><span class="ruby-operator">::</span><span class="ruby-constant">RSA</span>.<span class="ruby-identifier">new</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">open</span>(<span class="ruby-value str">'adobe.key'</span>,<span class="ruby-value str">'r'</span>).<span class="ruby-identifier">binmode</span>.<span class="ruby-identifier">read</span>)
139:         <span class="ruby-identifier">certificate</span> = <span class="ruby-constant">OpenSSL</span><span class="ruby-operator">::</span><span class="ruby-constant">X509</span><span class="ruby-operator">::</span><span class="ruby-constant">Certificate</span>.<span class="ruby-identifier">new</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">open</span>(<span class="ruby-value str">'adobe.crt'</span>,<span class="ruby-value str">'r'</span>).<span class="ruby-identifier">binmode</span>.<span class="ruby-identifier">read</span>)
140:       <span class="ruby-keyword kw">rescue</span>
141:         <span class="ruby-identifier">warn</span> <span class="ruby-value str">&quot;The Adobe private key is necessary to enable usage rights.\nYou do not seem to be Adobe :)... Aborting.&quot;</span>
142:         <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">nil</span>
143:       <span class="ruby-keyword kw">end</span>
144:       
145:       <span class="ruby-identifier">digsig</span> = <span class="ruby-constant">Signature</span><span class="ruby-operator">::</span><span class="ruby-constant">DigitalSignature</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">set_indirect</span>(<span class="ruby-keyword kw">true</span>)
146:       
147:       <span class="ruby-keyword kw">self</span>.<span class="ruby-constant">Catalog</span>.<span class="ruby-constant">AcroForm</span> <span class="ruby-operator">||=</span> <span class="ruby-constant">InteractiveForm</span>.<span class="ruby-identifier">new</span>
148:       <span class="ruby-comment cmt">#self.Catalog.AcroForm.SigFlags = InteractiveForm::SigFlags::APPENDONLY</span>
149:       
150:       <span class="ruby-identifier">digsig</span>.<span class="ruby-constant">Type</span> = <span class="ruby-identifier">:Sig</span> <span class="ruby-comment cmt">#:nodoc:</span>
151:       <span class="ruby-identifier">digsig</span>.<span class="ruby-constant">Contents</span> = <span class="ruby-constant">HexaString</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value str">&quot;\x00&quot;</span> <span class="ruby-operator">*</span> <span class="ruby-identifier">signfield_size</span>(<span class="ruby-identifier">certificate</span>, <span class="ruby-identifier">key</span>, [])) <span class="ruby-comment cmt">#:nodoc:</span>
152:       <span class="ruby-identifier">digsig</span>.<span class="ruby-constant">Filter</span> = <span class="ruby-constant">Name</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value str">&quot;Adobe.PPKLite&quot;</span>) <span class="ruby-comment cmt">#:nodoc:</span>
153:       <span class="ruby-identifier">digsig</span>.<span class="ruby-constant">Name</span> = <span class="ruby-value str">&quot;ARE Acrobat Product v8.0 P23 0002337&quot;</span> <span class="ruby-comment cmt">#:nodoc:</span>
154:       <span class="ruby-identifier">digsig</span>.<span class="ruby-constant">SubFilter</span> = <span class="ruby-constant">Name</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value str">&quot;adbe.pkcs7.detached&quot;</span>) <span class="ruby-comment cmt">#:nodoc:</span>
155:       <span class="ruby-identifier">digsig</span>.<span class="ruby-constant">ByteRange</span> = [<span class="ruby-value">0</span>, <span class="ruby-value">0</span>, <span class="ruby-value">0</span>, <span class="ruby-value">0</span>] <span class="ruby-comment cmt">#:nodoc:</span>
156:       
157:       <span class="ruby-identifier">sigref</span> = <span class="ruby-constant">Signature</span><span class="ruby-operator">::</span><span class="ruby-constant">Reference</span>.<span class="ruby-identifier">new</span> <span class="ruby-comment cmt">#:nodoc:</span>
158:       <span class="ruby-identifier">sigref</span>.<span class="ruby-constant">Type</span> = <span class="ruby-identifier">:SigRef</span> <span class="ruby-comment cmt">#:nodoc:</span>
159:       <span class="ruby-identifier">sigref</span>.<span class="ruby-constant">TransformMethod</span> = <span class="ruby-identifier">:UR3</span> <span class="ruby-comment cmt">#:nodoc:</span>
160:       <span class="ruby-identifier">sigref</span>.<span class="ruby-constant">Data</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-constant">Catalog</span>
161:       
162:       <span class="ruby-identifier">sigref</span>.<span class="ruby-constant">TransformParams</span> = <span class="ruby-constant">UsageRights</span><span class="ruby-operator">::</span><span class="ruby-constant">TransformParams</span>.<span class="ruby-identifier">new</span>
163:       <span class="ruby-identifier">sigref</span>.<span class="ruby-constant">TransformParams</span>.<span class="ruby-constant">P</span> = <span class="ruby-keyword kw">true</span> <span class="ruby-comment cmt">#:nodoc:</span>
164:       <span class="ruby-identifier">sigref</span>.<span class="ruby-constant">TransformParams</span>.<span class="ruby-constant">Type</span> = <span class="ruby-identifier">:TransformParams</span> <span class="ruby-comment cmt">#:nodoc:</span>
165:       <span class="ruby-identifier">sigref</span>.<span class="ruby-constant">TransformParams</span>.<span class="ruby-constant">V</span> = <span class="ruby-constant">UsageRights</span><span class="ruby-operator">::</span><span class="ruby-constant">TransformParams</span><span class="ruby-operator">::</span><span class="ruby-constant">VERSION</span>
166:       
167:       <span class="ruby-identifier">rights</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">right</span><span class="ruby-operator">|</span>
168:         
169:         <span class="ruby-identifier">sigref</span>.<span class="ruby-constant">TransformParams</span>[<span class="ruby-identifier">right</span>.<span class="ruby-identifier">first</span>] <span class="ruby-operator">||=</span> []
170:         <span class="ruby-identifier">sigref</span>.<span class="ruby-constant">TransformParams</span>[<span class="ruby-identifier">right</span>.<span class="ruby-identifier">first</span>].<span class="ruby-identifier">concat</span>(<span class="ruby-identifier">right</span>[<span class="ruby-value">1</span><span class="ruby-operator">..</span><span class="ruby-value">-1</span>])
171:         
172:       }
173:       
174:       <span class="ruby-identifier">digsig</span>.<span class="ruby-constant">Reference</span> = [ <span class="ruby-identifier">sigref</span> ]
175:       
176:       <span class="ruby-keyword kw">self</span>.<span class="ruby-constant">Catalog</span>.<span class="ruby-constant">Perms</span> <span class="ruby-operator">||=</span> <span class="ruby-constant">Perms</span>.<span class="ruby-identifier">new</span>
177:       <span class="ruby-keyword kw">self</span>.<span class="ruby-constant">Catalog</span>.<span class="ruby-constant">Perms</span>.<span class="ruby-constant">UR3</span> = <span class="ruby-identifier">digsig</span>
178:       
179:       <span class="ruby-comment cmt">#</span>
180:       <span class="ruby-comment cmt">#  Flattening the PDF to get file view.</span>
181:       <span class="ruby-comment cmt">#</span>
182:       <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">compile</span>
183:       
184:       <span class="ruby-comment cmt">#</span>
185:       <span class="ruby-comment cmt"># Creating an empty Xref table to compute signature byte range.</span>
186:       <span class="ruby-comment cmt">#</span>
187:       <span class="ruby-identifier">rebuild_dummy_xrefs</span>
188:       
189:       <span class="ruby-identifier">sigoffset</span> = <span class="ruby-identifier">get_object_offset</span>(<span class="ruby-identifier">digsig</span>.<span class="ruby-identifier">no</span>, <span class="ruby-identifier">digsig</span>.<span class="ruby-identifier">generation</span>) <span class="ruby-operator">+</span> <span class="ruby-identifier">digsig</span>.<span class="ruby-identifier">sigOffset</span>
190:       
191:       <span class="ruby-identifier">digsig</span>.<span class="ruby-constant">ByteRange</span>[<span class="ruby-value">0</span>] = <span class="ruby-value">0</span> 
192:       <span class="ruby-identifier">digsig</span>.<span class="ruby-constant">ByteRange</span>[<span class="ruby-value">1</span>] = <span class="ruby-identifier">sigoffset</span>
193:       <span class="ruby-identifier">digsig</span>.<span class="ruby-constant">ByteRange</span>[<span class="ruby-value">2</span>] = <span class="ruby-identifier">sigoffset</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">digsig</span>.<span class="ruby-constant">Contents</span>.<span class="ruby-identifier">size</span>
194:       
195:       <span class="ruby-identifier">digsig</span>.<span class="ruby-constant">ByteRange</span>[<span class="ruby-value">3</span>] = <span class="ruby-identifier">filesize</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">digsig</span>.<span class="ruby-constant">ByteRange</span>[<span class="ruby-value">2</span>] <span class="ruby-keyword kw">until</span> <span class="ruby-identifier">digsig</span>.<span class="ruby-constant">ByteRange</span>[<span class="ruby-value">3</span>] <span class="ruby-operator">==</span> <span class="ruby-identifier">filesize</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">digsig</span>.<span class="ruby-constant">ByteRange</span>[<span class="ruby-value">2</span>]
196:       
197:       <span class="ruby-comment cmt"># From that point the file size remains constant</span>
198:       
199:       <span class="ruby-comment cmt">#</span>
200:       <span class="ruby-comment cmt"># Correct Xrefs variations caused by ByteRange modifications.</span>
201:       <span class="ruby-comment cmt">#</span>
202:       <span class="ruby-identifier">rebuildxrefs</span>
203:       
204:       <span class="ruby-identifier">filedata</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">to_bin</span>
205:       <span class="ruby-identifier">signable_data</span> = <span class="ruby-identifier">filedata</span>[<span class="ruby-identifier">digsig</span>.<span class="ruby-constant">ByteRange</span>[<span class="ruby-value">0</span>],<span class="ruby-identifier">digsig</span>.<span class="ruby-constant">ByteRange</span>[<span class="ruby-value">1</span>]] <span class="ruby-operator">+</span> <span class="ruby-identifier">filedata</span>[<span class="ruby-identifier">digsig</span>.<span class="ruby-constant">ByteRange</span>[<span class="ruby-value">2</span>],<span class="ruby-identifier">digsig</span>.<span class="ruby-constant">ByteRange</span>[<span class="ruby-value">3</span>]]
206:       
207:       <span class="ruby-identifier">signature</span> = <span class="ruby-constant">OpenSSL</span><span class="ruby-operator">::</span><span class="ruby-constant">PKCS7</span>.<span class="ruby-identifier">sign</span>(<span class="ruby-identifier">certificate</span>, <span class="ruby-identifier">key</span>, <span class="ruby-identifier">signable_data</span>, [], <span class="ruby-constant">OpenSSL</span><span class="ruby-operator">::</span><span class="ruby-constant">PKCS7</span><span class="ruby-operator">::</span><span class="ruby-constant">DETACHED</span> <span class="ruby-operator">|</span> <span class="ruby-constant">OpenSSL</span><span class="ruby-operator">::</span><span class="ruby-constant">PKCS7</span><span class="ruby-operator">::</span><span class="ruby-constant">BINARY</span>).<span class="ruby-identifier">to_der</span>
208:       <span class="ruby-identifier">digsig</span>.<span class="ruby-constant">Contents</span>[<span class="ruby-value">0</span>, <span class="ruby-identifier">signature</span>.<span class="ruby-identifier">size</span>] = <span class="ruby-identifier">signature</span>
209:       
210:       <span class="ruby-comment cmt">#</span>
211:       <span class="ruby-comment cmt"># No more modification are allowed after signing.</span>
212:       <span class="ruby-comment cmt">#</span>
213:       <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">freeze</span>
214:       
215:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000327" class="method-detail">
        <a name="M000327"></a>

        <div class="method-heading">
          <a href="#M000327" class="method-signature">
          <span class="method-name">encrypt</span><span class="method-args">(userpasswd, ownerpasswd, options = {})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Encrypts the current document with the provided passwords. The document
will be encrypted at writing-on-disk time.
</p>
<table>
<tr><td valign="top"><em>userpasswd</em>:</td><td>The user password.

</td></tr>
<tr><td valign="top"><em>ownerpasswd</em>:</td><td>The owner password.

</td></tr>
<tr><td valign="top"><em>options</em>:</td><td>A set of options to configure encryption.

</td></tr>
</table>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000327-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000327-source">
<pre>
     <span class="ruby-comment cmt"># File sources/parser/encryption.rb, line 174</span>
174:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">encrypt</span>(<span class="ruby-identifier">userpasswd</span>, <span class="ruby-identifier">ownerpasswd</span>, <span class="ruby-identifier">options</span> = {})
175:     
176:       <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">is_encrypted?</span>
177:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">EncryptionError</span>, <span class="ruby-value str">&quot;PDF is already encrypted&quot;</span>
178:       <span class="ruby-keyword kw">end</span>
179: 
180:       <span class="ruby-comment cmt">#</span>
181:       <span class="ruby-comment cmt"># Default encryption options.</span>
182:       <span class="ruby-comment cmt">#</span>
183:       <span class="ruby-identifier">params</span> = 
184:       {
185:         <span class="ruby-identifier">:Algorithm</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:RC4</span>,         <span class="ruby-comment cmt"># :RC4 or :AES</span>
186:         <span class="ruby-identifier">:KeyLength</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">128</span>,          <span class="ruby-comment cmt"># Key size in bits</span>
187:         <span class="ruby-identifier">:EncryptMetadata</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span>,    <span class="ruby-comment cmt"># Metadata shall be encrypted?</span>
188:         <span class="ruby-identifier">:Permissions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">Encryption</span><span class="ruby-operator">::</span><span class="ruby-constant">Standard</span><span class="ruby-operator">::</span><span class="ruby-constant">Permissions</span><span class="ruby-operator">::</span><span class="ruby-constant">ALL</span>    <span class="ruby-comment cmt"># Document permissions</span>
189:       }
190: 
191:       <span class="ruby-identifier">params</span>.<span class="ruby-identifier">update</span>(<span class="ruby-identifier">options</span>)
192: 
193:       <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:Algorithm</span>]
194:       <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:RC4</span>
195:         <span class="ruby-identifier">algorithm</span> = <span class="ruby-constant">Encryption</span><span class="ruby-operator">::</span><span class="ruby-constant">ARC4</span>
196:         <span class="ruby-keyword kw">if</span> (<span class="ruby-value">40</span><span class="ruby-operator">..</span><span class="ruby-value">128</span>) <span class="ruby-operator">===</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:KeyLength</span>] <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:KeyLength</span>] <span class="ruby-operator">%</span> <span class="ruby-value">8</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
197:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:KeyLength</span>] <span class="ruby-operator">&gt;</span> <span class="ruby-value">40</span>
198:             <span class="ruby-identifier">version</span> = <span class="ruby-value">2</span>
199:             <span class="ruby-identifier">revision</span> = <span class="ruby-value">3</span>
200:           <span class="ruby-keyword kw">else</span>
201:             <span class="ruby-identifier">version</span> = <span class="ruby-value">1</span>
202:             <span class="ruby-identifier">revision</span> = <span class="ruby-value">2</span>
203:           <span class="ruby-keyword kw">end</span>
204:         <span class="ruby-keyword kw">else</span>
205:           <span class="ruby-identifier">raise</span> <span class="ruby-constant">EncryptionError</span>, <span class="ruby-value str">&quot;Invalid key length&quot;</span>
206:         <span class="ruby-keyword kw">end</span>
207:       <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:AES</span>
208:         <span class="ruby-identifier">algorithm</span> = <span class="ruby-constant">Encryption</span><span class="ruby-operator">::</span><span class="ruby-constant">AES</span>
209:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:KeyLength</span>] <span class="ruby-operator">==</span> <span class="ruby-value">128</span> 
210:           <span class="ruby-identifier">version</span> = <span class="ruby-identifier">revision</span> = <span class="ruby-value">4</span>
211:         <span class="ruby-keyword kw">else</span>
212:           <span class="ruby-identifier">raise</span> <span class="ruby-constant">EncryptionError</span>, <span class="ruby-value str">&quot;Invalid key length&quot;</span>
213:         <span class="ruby-keyword kw">end</span>
214:       <span class="ruby-keyword kw">else</span>
215:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">EncryptionNotSupportedError</span>, <span class="ruby-node">&quot;Algorithm not supported : #{params[:Algorithm]}&quot;</span>
216:       <span class="ruby-keyword kw">end</span>
217:      
218:       <span class="ruby-identifier">id</span> = (<span class="ruby-identifier">get_doc_attr</span>(<span class="ruby-identifier">:ID</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">gen_id</span>).<span class="ruby-identifier">first</span>
219: 
220:       <span class="ruby-identifier">handler</span> = <span class="ruby-constant">Encryption</span><span class="ruby-operator">::</span><span class="ruby-constant">Standard</span><span class="ruby-operator">::</span><span class="ruby-constant">Dictionary</span>.<span class="ruby-identifier">new</span>
221:       <span class="ruby-identifier">handler</span>.<span class="ruby-constant">Filter</span> = <span class="ruby-identifier">:Standard</span> <span class="ruby-comment cmt">#:nodoc:</span>
222:       <span class="ruby-identifier">handler</span>.<span class="ruby-constant">V</span> = <span class="ruby-identifier">version</span>
223:       <span class="ruby-identifier">handler</span>.<span class="ruby-constant">R</span> = <span class="ruby-identifier">revision</span>
224:       <span class="ruby-identifier">handler</span>.<span class="ruby-constant">Length</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:KeyLength</span>]
225:       <span class="ruby-identifier">handler</span>.<span class="ruby-constant">P</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:Permissions</span>] 
226:       
227:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">revision</span> <span class="ruby-operator">==</span> <span class="ruby-value">4</span>
228:         <span class="ruby-identifier">handler</span>.<span class="ruby-constant">EncryptMetadata</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:EncryptMetadata</span>]
229:         <span class="ruby-identifier">handler</span>.<span class="ruby-constant">CF</span> = <span class="ruby-constant">Dictionary</span>.<span class="ruby-identifier">new</span>
230:         <span class="ruby-identifier">cryptfilter</span> = <span class="ruby-constant">Encryption</span><span class="ruby-operator">::</span><span class="ruby-constant">CryptFilterDictionary</span>.<span class="ruby-identifier">new</span>
231:         <span class="ruby-identifier">cryptfilter</span>.<span class="ruby-constant">AuthEvent</span> = <span class="ruby-identifier">:DocOpen</span>
232:         <span class="ruby-identifier">cryptfilter</span>.<span class="ruby-constant">CFM</span> = <span class="ruby-identifier">:AESV2</span>
233:         <span class="ruby-identifier">cryptfilter</span>.<span class="ruby-constant">Length</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:KeyLength</span>] <span class="ruby-operator">&gt;&gt;</span> <span class="ruby-value">3</span>
234: 
235:         <span class="ruby-identifier">handler</span>.<span class="ruby-constant">CF</span>[<span class="ruby-identifier">:StdCF</span>] = <span class="ruby-identifier">cryptfilter</span>
236:         <span class="ruby-identifier">handler</span>.<span class="ruby-constant">StmF</span> = <span class="ruby-identifier">handler</span>.<span class="ruby-constant">StrF</span> = <span class="ruby-identifier">:StdCF</span>
237:       <span class="ruby-keyword kw">end</span>
238:       
239:       <span class="ruby-identifier">handler</span>.<span class="ruby-identifier">set_owner_password</span>(<span class="ruby-identifier">userpasswd</span>, <span class="ruby-identifier">ownerpasswd</span>)
240:       <span class="ruby-identifier">handler</span>.<span class="ruby-identifier">set_user_password</span>(<span class="ruby-identifier">userpasswd</span>, <span class="ruby-identifier">id</span>)
241:       
242:       <span class="ruby-identifier">encryption_key</span> = <span class="ruby-identifier">handler</span>.<span class="ruby-identifier">compute_encryption_key</span>(<span class="ruby-identifier">userpasswd</span>, <span class="ruby-identifier">id</span>)
243: 
244:       <span class="ruby-identifier">fileInfo</span> = <span class="ruby-identifier">get_trailer_info</span>
245:       <span class="ruby-identifier">fileInfo</span>[<span class="ruby-identifier">:Encrypt</span>] = <span class="ruby-keyword kw">self</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">handler</span>
246: 
247:       <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">extend</span>(<span class="ruby-constant">Encryption</span><span class="ruby-operator">::</span><span class="ruby-constant">EncryptedDocument</span>)
248:       <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">encryption_dict</span> = <span class="ruby-identifier">handler</span>
249:       <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">encryption_key</span> = <span class="ruby-identifier">encryption_key</span>
250:       <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">stm_algo</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">str_algo</span> = <span class="ruby-identifier">algorithm</span>
251: 
252:       <span class="ruby-keyword kw">self</span>
253:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000361" class="method-detail">
        <a name="M000361"></a>

        <div class="method-heading">
          <a href="#M000361" class="method-signature">
          <span class="method-name">export_to_graph</span><span class="method-args">(filename)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Exports the document to a dot Graphiz file.
</p>
<table>
<tr><td valign="top"><em>filename</em>:</td><td>The path where to <a href="PDF.html#M000333">save</a> the file.

</td></tr>
</table>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000361-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000361-source">
<pre>
     <span class="ruby-comment cmt"># File sources/parser/export.rb, line 34</span>
 34:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">export_to_graph</span>(<span class="ruby-identifier">filename</span>)
 35:       
 36:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">appearance</span>(<span class="ruby-identifier">object</span>) <span class="ruby-comment cmt">#:nodoc:</span>
 37:       
 38:         <span class="ruby-identifier">label</span> = <span class="ruby-identifier">object</span>.<span class="ruby-identifier">type</span>.<span class="ruby-identifier">to_s</span>
 39:         <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">object</span>
 40:           <span class="ruby-keyword kw">when</span> <span class="ruby-constant">Catalog</span>
 41:             <span class="ruby-identifier">fontcolor</span> = <span class="ruby-value str">&quot;red&quot;</span>
 42:             <span class="ruby-identifier">color</span> = <span class="ruby-value str">&quot;mistyrose&quot;</span>
 43:             <span class="ruby-identifier">shape</span> = <span class="ruby-value str">&quot;doublecircle&quot;</span>
 44:           <span class="ruby-keyword kw">when</span> <span class="ruby-constant">Name</span>, <span class="ruby-constant">Number</span>
 45:             <span class="ruby-identifier">label</span> = <span class="ruby-identifier">object</span>.<span class="ruby-identifier">value</span> 
 46:             <span class="ruby-identifier">fontcolor</span> = <span class="ruby-value str">&quot;orange&quot;</span>
 47:             <span class="ruby-identifier">color</span> = <span class="ruby-value str">&quot;lightgoldenrodyellow&quot;</span>
 48:             <span class="ruby-identifier">shape</span> = <span class="ruby-value str">&quot;polygon&quot;</span>
 49:            <span class="ruby-keyword kw">when</span> <span class="ruby-constant">String</span>
 50:             <span class="ruby-identifier">label</span> = <span class="ruby-identifier">object</span>.<span class="ruby-identifier">value</span> <span class="ruby-keyword kw">unless</span> (<span class="ruby-identifier">object</span>.<span class="ruby-identifier">is_binary_data?</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">object</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">50</span>)
 51:             <span class="ruby-identifier">fontcolor</span> = <span class="ruby-value str">&quot;red&quot;</span>
 52:             <span class="ruby-identifier">color</span> = <span class="ruby-value str">&quot;white&quot;</span>
 53:             <span class="ruby-identifier">shape</span> = <span class="ruby-value str">&quot;polygon&quot;</span>
 54:           <span class="ruby-keyword kw">when</span> <span class="ruby-constant">Array</span>
 55:             <span class="ruby-identifier">fontcolor</span> = <span class="ruby-value str">&quot;green&quot;</span>
 56:             <span class="ruby-identifier">color</span> = <span class="ruby-value str">&quot;lightcyan&quot;</span>
 57:             <span class="ruby-identifier">shape</span> = <span class="ruby-value str">&quot;ellipse&quot;</span>
 58:         <span class="ruby-keyword kw">else</span>
 59:           <span class="ruby-identifier">fontcolor</span> = <span class="ruby-value str">&quot;blue&quot;</span>
 60:           <span class="ruby-identifier">color</span> = <span class="ruby-value str">&quot;aliceblue&quot;</span>
 61:           <span class="ruby-identifier">shape</span> = <span class="ruby-value str">&quot;ellipse&quot;</span>
 62:         <span class="ruby-keyword kw">end</span>
 63:       
 64:         { <span class="ruby-identifier">:label</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">label</span>, <span class="ruby-identifier">:fontcolor</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">fontcolor</span>, <span class="ruby-identifier">:color</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">color</span>, <span class="ruby-identifier">:shape</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">shape</span> }
 65:       <span class="ruby-keyword kw">end</span>
 66:       
 67:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">add_edges</span>(<span class="ruby-identifier">pdf</span>, <span class="ruby-identifier">fd</span>, <span class="ruby-identifier">object</span>) <span class="ruby-comment cmt">#:nodoc:</span>
 68:         
 69:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">object</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Array</span>) <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">object</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">ObjectStream</span>)
 70:           
 71:           <span class="ruby-identifier">object</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">subobj</span><span class="ruby-operator">|</span>
 72:             
 73:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">subobj</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Reference</span>) <span class="ruby-keyword kw">then</span> <span class="ruby-identifier">subobj</span> = <span class="ruby-identifier">pdf</span>.<span class="ruby-identifier">indirect_objects</span>[<span class="ruby-identifier">subobj</span>] <span class="ruby-keyword kw">end</span>
 74:             
 75:             <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">subobj</span>.<span class="ruby-identifier">nil?</span>
 76:               <span class="ruby-identifier">fd</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;\t#{object.object_id} -&gt; #{subobj.object_id}\n&quot;</span>
 77:             <span class="ruby-keyword kw">end</span>
 78:           }
 79:           
 80:         <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">object</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Dictionary</span>)
 81:           
 82:           <span class="ruby-identifier">object</span>.<span class="ruby-identifier">each_pair</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">name</span>, <span class="ruby-identifier">subobj</span><span class="ruby-operator">|</span>
 83:             
 84:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">subobj</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Reference</span>) <span class="ruby-keyword kw">then</span> <span class="ruby-identifier">subobj</span> = <span class="ruby-identifier">pdf</span>.<span class="ruby-identifier">indirect_objects</span>[<span class="ruby-identifier">subobj</span>] <span class="ruby-keyword kw">end</span>
 85:             
 86:             <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">subobj</span>.<span class="ruby-identifier">nil?</span>
 87:               <span class="ruby-identifier">fd</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;\t#{object.object_id} -&gt; #{subobj.object_id} [label=\&quot;#{name.value}\&quot;,fontsize=7];\n&quot;</span>
 88:             <span class="ruby-keyword kw">end</span>
 89:           }
 90:           
 91:         <span class="ruby-keyword kw">end</span>
 92:         
 93:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">object</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Stream</span>)
 94:           
 95:           <span class="ruby-identifier">object</span>.<span class="ruby-identifier">dictionary</span>.<span class="ruby-identifier">each_pair</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">key</span>, <span class="ruby-identifier">value</span><span class="ruby-operator">|</span>
 96:           
 97:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">value</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Reference</span>) <span class="ruby-keyword kw">then</span> <span class="ruby-identifier">value</span> = <span class="ruby-identifier">pdf</span>.<span class="ruby-identifier">indirect_objects</span>[<span class="ruby-identifier">subobj</span>] <span class="ruby-keyword kw">end</span>
 98:             
 99:             <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">value</span>.<span class="ruby-identifier">nil?</span>
100:               <span class="ruby-identifier">fd</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;\t#{object.object_id} -&gt; #{value.object_id} [label=\&quot;#{key.value}\&quot;,fontsize=7];\n&quot;</span>
101:             <span class="ruby-keyword kw">end</span>
102:           }
103:           
104:         <span class="ruby-keyword kw">end</span>
105:         
106:       <span class="ruby-keyword kw">end</span>
107:       
108:       <span class="ruby-identifier">graphname</span> = <span class="ruby-value str">&quot;PDF&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">graphname</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">graphname</span>.<span class="ruby-identifier">empty?</span>
109:       
110:       <span class="ruby-identifier">fd</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">open</span>(<span class="ruby-identifier">filename</span>, <span class="ruby-value str">&quot;w&quot;</span>)
111:     
112:       <span class="ruby-keyword kw">begin</span>
113:         
114:         <span class="ruby-identifier">fd</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;digraph #{graphname} {\n\n&quot;</span>
115:         
116:         <span class="ruby-identifier">objects</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">objects</span>(<span class="ruby-keyword kw">true</span>).<span class="ruby-identifier">find_all</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">obj</span><span class="ruby-operator">|</span> <span class="ruby-keyword kw">not</span> <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Reference</span>) }
117:         
118:         <span class="ruby-identifier">objects</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">object</span><span class="ruby-operator">|</span>
119:           
120:           <span class="ruby-identifier">attr</span> = <span class="ruby-identifier">appearance</span>(<span class="ruby-identifier">object</span>)
121:           
122:           <span class="ruby-identifier">fd</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;\t#{object.object_id} [label=\&quot;#{attr[:label]}\&quot;,shape=#{attr[:shape]},color=#{attr[:color]},style=filled,fontcolor=#{attr[:fontcolor]}];\n&quot;</span>
123:           
124:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">object</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Stream</span>)
125:             
126:             <span class="ruby-identifier">object</span>.<span class="ruby-identifier">dictionary</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">value</span><span class="ruby-operator">|</span>
127:             
128:               <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">value</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Reference</span>)
129:                 <span class="ruby-identifier">attr</span> = <span class="ruby-identifier">appearance</span>(<span class="ruby-identifier">value</span>)
130:                 <span class="ruby-identifier">fd</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;\t#{value.object_id} [label=\&quot;#{attr[:label]}\&quot;,shape=#{attr[:shape]},color=#{attr[:color]},style=filled,fontcolor=#{attr[:fontcolor]}];\n&quot;</span>
131:               <span class="ruby-keyword kw">end</span>
132:             
133:             }
134:             
135:           <span class="ruby-keyword kw">end</span>
136:           
137:           <span class="ruby-identifier">add_edges</span>(<span class="ruby-keyword kw">self</span>, <span class="ruby-identifier">fd</span>, <span class="ruby-identifier">object</span>)
138:         
139:         }
140:         
141:         <span class="ruby-identifier">fd</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot;\n}&quot;</span>
142:         
143:       <span class="ruby-keyword kw">ensure</span>
144:         <span class="ruby-identifier">fd</span>.<span class="ruby-identifier">close</span>
145:       <span class="ruby-keyword kw">end</span>
146:       
147:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000362" class="method-detail">
        <a name="M000362"></a>

        <div class="method-heading">
          <a href="#M000362" class="method-signature">
          <span class="method-name">export_to_graphml</span><span class="method-args">(filename)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Exports the document to a GraphML file.
</p>
<table>
<tr><td valign="top"><em>filename</em>:</td><td>The path where to <a href="PDF.html#M000333">save</a> the file.

</td></tr>
</table>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000362-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000362-source">
<pre>
     <span class="ruby-comment cmt"># File sources/parser/export.rb, line 153</span>
153:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">export_to_graphml</span>(<span class="ruby-identifier">filename</span>)
154:       
155:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">declare_node</span>(<span class="ruby-identifier">id</span>, <span class="ruby-identifier">attr</span>) <span class="ruby-comment cmt">#:nodoc:</span>
156:         <span class="ruby-node">&quot; &lt;node id=\&quot;#{id}\&quot;&gt;\n&quot;</span> <span class="ruby-operator">&lt;&lt;</span>
157:         <span class="ruby-value str">&quot;  &lt;data key=\&quot;d0\&quot;&gt;\n&quot;</span> <span class="ruby-operator">&lt;&lt;</span>
158:         <span class="ruby-value str">&quot;    &lt;y:ShapeNode&gt;\n&quot;</span> <span class="ruby-operator">&lt;&lt;</span>
159:         <span class="ruby-node">&quot;     &lt;y:NodeLabel&gt;#{attr[:label]}&lt;/y:NodeLabel&gt;\n&quot;</span> <span class="ruby-operator">&lt;&lt;</span>
160:         <span class="ruby-comment cmt">#~ &quot;     &lt;y:Shape type=\&quot;#{attr[:shape]}\&quot;/&gt;\n&quot; &lt;&lt;</span>
161:         <span class="ruby-value str">&quot;    &lt;/y:ShapeNode&gt;\n&quot;</span> <span class="ruby-operator">&lt;&lt;</span>
162:         <span class="ruby-value str">&quot;  &lt;/data&gt;\n&quot;</span> <span class="ruby-operator">&lt;&lt;</span>
163:         <span class="ruby-value str">&quot; &lt;/node&gt;\n&quot;</span>
164:       <span class="ruby-keyword kw">end</span>
165:       
166:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">declare_edge</span>(<span class="ruby-identifier">id</span>, <span class="ruby-identifier">src</span>, <span class="ruby-identifier">dest</span>, <span class="ruby-identifier">label</span> = <span class="ruby-keyword kw">nil</span>) <span class="ruby-comment cmt">#:nodoc:</span>
167:         <span class="ruby-node">&quot; &lt;edge id=\&quot;#{id}\&quot; source=\&quot;#{src}\&quot; target=\&quot;#{dest}\&quot;&gt;\n&quot;</span> <span class="ruby-operator">&lt;&lt;</span> 
168:         <span class="ruby-value str">&quot;  &lt;data key=\&quot;d1\&quot;&gt;\n&quot;</span> <span class="ruby-operator">&lt;&lt;</span>
169:         <span class="ruby-value str">&quot;   &lt;y:PolyLineEdge&gt;\n&quot;</span> <span class="ruby-operator">&lt;&lt;</span>
170:         <span class="ruby-value str">&quot;    &lt;y:LineStyle type=\&quot;line\&quot; width=\&quot;1.0\&quot; color=\&quot;#000000\&quot;/&gt;\n&quot;</span> <span class="ruby-operator">&lt;&lt;</span>
171:         <span class="ruby-value str">&quot;    &lt;y:Arrows source=\&quot;none\&quot; target=\&quot;standard\&quot;/&gt;\n&quot;</span> <span class="ruby-operator">&lt;&lt;</span> 
172:         <span class="ruby-node">&quot;    &lt;y:EdgeLabel&gt;#{label.to_s}&lt;/y:EdgeLabel&gt;\n&quot;</span> <span class="ruby-operator">&lt;&lt;</span>
173:         <span class="ruby-value str">&quot;   &lt;/y:PolyLineEdge&gt;\n&quot;</span> <span class="ruby-operator">&lt;&lt;</span>
174:         <span class="ruby-value str">&quot;  &lt;/data&gt;\n&quot;</span> <span class="ruby-operator">&lt;&lt;</span>
175:         <span class="ruby-value str">&quot; &lt;/edge&gt;\n&quot;</span>
176:       <span class="ruby-keyword kw">end</span>
177:       
178:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">appearance</span>(<span class="ruby-identifier">object</span>) <span class="ruby-comment cmt">#:nodoc:</span>
179:       
180:         <span class="ruby-identifier">label</span> = <span class="ruby-identifier">object</span>.<span class="ruby-identifier">type</span>.<span class="ruby-identifier">to_s</span>
181:         <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">object</span>
182:           <span class="ruby-keyword kw">when</span> <span class="ruby-constant">Catalog</span>
183:             <span class="ruby-identifier">fontcolor</span> = <span class="ruby-value str">&quot;red&quot;</span>
184:             <span class="ruby-identifier">color</span> = <span class="ruby-value str">&quot;mistyrose&quot;</span>
185:             <span class="ruby-identifier">shape</span> = <span class="ruby-value str">&quot;doublecircle&quot;</span>
186:           <span class="ruby-keyword kw">when</span> <span class="ruby-constant">Name</span>, <span class="ruby-constant">Number</span>
187:             <span class="ruby-identifier">label</span> = <span class="ruby-identifier">object</span>.<span class="ruby-identifier">value</span> 
188:             <span class="ruby-identifier">fontcolor</span> = <span class="ruby-value str">&quot;orange&quot;</span>
189:             <span class="ruby-identifier">color</span> = <span class="ruby-value str">&quot;lightgoldenrodyellow&quot;</span>
190:             <span class="ruby-identifier">shape</span> = <span class="ruby-value str">&quot;polygon&quot;</span>
191:           <span class="ruby-keyword kw">when</span> <span class="ruby-constant">String</span>
192:             <span class="ruby-identifier">label</span> = <span class="ruby-identifier">object</span>.<span class="ruby-identifier">value</span> <span class="ruby-keyword kw">unless</span> (<span class="ruby-identifier">object</span>.<span class="ruby-identifier">is_binary_data?</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">object</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">50</span>)
193:             <span class="ruby-identifier">fontcolor</span> = <span class="ruby-value str">&quot;red&quot;</span>
194:             <span class="ruby-identifier">color</span> = <span class="ruby-value str">&quot;white&quot;</span>
195:             <span class="ruby-identifier">shape</span> = <span class="ruby-value str">&quot;polygon&quot;</span>
196:           <span class="ruby-keyword kw">when</span> <span class="ruby-constant">Array</span>
197:             <span class="ruby-identifier">fontcolor</span> = <span class="ruby-value str">&quot;green&quot;</span>
198:             <span class="ruby-identifier">color</span> = <span class="ruby-value str">&quot;lightcyan&quot;</span>
199:             <span class="ruby-identifier">shape</span> = <span class="ruby-value str">&quot;ellipse&quot;</span>
200:         <span class="ruby-keyword kw">else</span>
201:           <span class="ruby-identifier">fontcolor</span> = <span class="ruby-value str">&quot;blue&quot;</span>
202:           <span class="ruby-identifier">color</span> = <span class="ruby-value str">&quot;aliceblue&quot;</span>
203:           <span class="ruby-identifier">shape</span> = <span class="ruby-value str">&quot;ellipse&quot;</span>
204:         <span class="ruby-keyword kw">end</span>
205:       
206:         { <span class="ruby-identifier">:label</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">label</span>, <span class="ruby-identifier">:fontcolor</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">fontcolor</span>, <span class="ruby-identifier">:color</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">color</span>, <span class="ruby-identifier">:shape</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">shape</span> }
207:       <span class="ruby-keyword kw">end</span>
208:       
209:      <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">add_edges</span>(<span class="ruby-identifier">pdf</span>, <span class="ruby-identifier">fd</span>, <span class="ruby-identifier">object</span>, <span class="ruby-identifier">id</span>) <span class="ruby-comment cmt">#:nodoc:</span>
210:         
211:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">object</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Array</span>) <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">object</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">ObjectStream</span>)
212:           
213:           <span class="ruby-identifier">object</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">subobj</span><span class="ruby-operator">|</span>
214:             
215:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">subobj</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Reference</span>) <span class="ruby-keyword kw">then</span> <span class="ruby-identifier">subobj</span> = <span class="ruby-identifier">pdf</span>.<span class="ruby-identifier">indirect_objects</span>[<span class="ruby-identifier">subobj</span>] <span class="ruby-keyword kw">end</span>
216:             
217:             <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">subobj</span>.<span class="ruby-identifier">nil?</span>
218:               <span class="ruby-identifier">fd</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">declare_edge</span>(<span class="ruby-node">&quot;e#{id}&quot;</span>, <span class="ruby-node">&quot;n#{object.object_id}&quot;</span>, <span class="ruby-node">&quot;n#{subobj.object_id}&quot;</span>)
219:               <span class="ruby-identifier">id</span> = <span class="ruby-identifier">id</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>
220:             <span class="ruby-keyword kw">end</span>
221:           }
222:           
223:         <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">object</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Dictionary</span>)
224:           
225:           <span class="ruby-identifier">object</span>.<span class="ruby-identifier">each_pair</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">name</span>, <span class="ruby-identifier">subobj</span><span class="ruby-operator">|</span>
226:             
227:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">subobj</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Reference</span>) <span class="ruby-keyword kw">then</span> <span class="ruby-identifier">subobj</span> = <span class="ruby-identifier">pdf</span>.<span class="ruby-identifier">indirect_objects</span>[<span class="ruby-identifier">subobj</span>] <span class="ruby-keyword kw">end</span>
228:             
229:             <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">subobj</span>.<span class="ruby-identifier">nil?</span>
230:               <span class="ruby-identifier">fd</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">declare_edge</span>(<span class="ruby-node">&quot;e#{id}&quot;</span>, <span class="ruby-node">&quot;n#{object.object_id}&quot;</span>, <span class="ruby-node">&quot;n#{subobj.object_id}&quot;</span>, <span class="ruby-identifier">name</span>.<span class="ruby-identifier">value</span>)
231:               <span class="ruby-identifier">id</span> = <span class="ruby-identifier">id</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>
232:             <span class="ruby-keyword kw">end</span>
233:           }
234:           
235:         <span class="ruby-keyword kw">end</span>
236:         
237:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">object</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Stream</span>)
238:           
239:           <span class="ruby-identifier">object</span>.<span class="ruby-identifier">dictionary</span>.<span class="ruby-identifier">each_pair</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">key</span>, <span class="ruby-identifier">value</span><span class="ruby-operator">|</span>
240:           
241:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">value</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Reference</span>) <span class="ruby-keyword kw">then</span> <span class="ruby-identifier">value</span> = <span class="ruby-identifier">pdf</span>.<span class="ruby-identifier">indirect_objects</span>[<span class="ruby-identifier">subobj</span>] <span class="ruby-keyword kw">end</span>
242:             
243:             <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">value</span>.<span class="ruby-identifier">nil?</span>
244:               <span class="ruby-identifier">fd</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">declare_edge</span>(<span class="ruby-node">&quot;e#{id}&quot;</span>, <span class="ruby-node">&quot;n#{object.object_id}&quot;</span>, <span class="ruby-node">&quot;n#{value.object_id}&quot;</span>, <span class="ruby-identifier">key</span>.<span class="ruby-identifier">value</span>)
245:               <span class="ruby-identifier">id</span> = <span class="ruby-identifier">id</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>
246:             <span class="ruby-keyword kw">end</span>
247:           }
248:           
249:         <span class="ruby-keyword kw">end</span>
250:         
251:         <span class="ruby-identifier">id</span>
252:       <span class="ruby-keyword kw">end</span>
253:       
254:       <span class="ruby-ivar">@@edge_nb</span> = <span class="ruby-value">1</span>
255:       
256:       <span class="ruby-identifier">graphname</span> = <span class="ruby-value str">&quot;PDF&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">graphname</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">graphname</span>.<span class="ruby-identifier">empty?</span>
257:       
258:       <span class="ruby-identifier">fd</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">open</span>(<span class="ruby-identifier">filename</span>, <span class="ruby-value str">&quot;w&quot;</span>)
259:       
260:       <span class="ruby-identifier">edge_nb</span> = <span class="ruby-value">1</span>
261:       <span class="ruby-keyword kw">begin</span>
262:         
263:         <span class="ruby-identifier">fd</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">'&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;'</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot;\n&quot;</span>
264:         <span class="ruby-identifier">fd</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">'&lt;graphml xmlns=&quot;http://graphml.graphdrawing.org/xmlns/graphml&quot;'</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot;\n&quot;</span>
265:         <span class="ruby-identifier">fd</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">' xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;'</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot;\n&quot;</span>
266:         <span class="ruby-identifier">fd</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">' xsi:schemaLocation=&quot;http://graphml.graphdrawing.org/xmlns/graphml '</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot;\n&quot;</span>
267:         <span class="ruby-identifier">fd</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">' http://www.yworks.com/xml/schema/graphml/1.0/ygraphml.xsd&quot;'</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot;\n&quot;</span>
268:         <span class="ruby-identifier">fd</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">' xmlns:y=&quot;http://www.yworks.com/xml/graphml&quot;&gt;'</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot;\n&quot;</span>
269:         <span class="ruby-identifier">fd</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">'&lt;key id=&quot;d0&quot; for=&quot;node&quot; yfiles.type=&quot;nodegraphics&quot;/&gt;'</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot;\n&quot;</span>
270:         <span class="ruby-identifier">fd</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">'&lt;key id=&quot;d1&quot; for=&quot;edge&quot; yfiles.type=&quot;edgegraphics&quot;/&gt;'</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot;\n&quot;</span>
271:         <span class="ruby-identifier">fd</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">&quot;&lt;graph id=\&quot;#{graphname}\&quot; edgedefault=\&quot;directed\&quot;&gt;\n&quot;</span>
272:         
273:         <span class="ruby-identifier">objects</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">objects</span>(<span class="ruby-keyword kw">true</span>).<span class="ruby-identifier">find_all</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">obj</span><span class="ruby-operator">|</span> <span class="ruby-keyword kw">not</span> <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Reference</span>) }
274:         
275:         <span class="ruby-identifier">objects</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">object</span><span class="ruby-operator">|</span>
276:           
277:           <span class="ruby-identifier">fd</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">declare_node</span>(<span class="ruby-node">&quot;n#{object.object_id}&quot;</span>, <span class="ruby-identifier">appearance</span>(<span class="ruby-identifier">object</span>))
278:           
279:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">object</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Stream</span>)
280:             
281:             <span class="ruby-identifier">object</span>.<span class="ruby-identifier">dictionary</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">value</span><span class="ruby-operator">|</span>
282:             
283:               <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">value</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Reference</span>)
284:                 <span class="ruby-identifier">fd</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">declare_node</span>(<span class="ruby-identifier">value</span>.<span class="ruby-identifier">object_id</span>, <span class="ruby-identifier">appearance</span>(<span class="ruby-identifier">value</span>))
285:               <span class="ruby-keyword kw">end</span>
286:             }
287:           <span class="ruby-keyword kw">end</span>
288:           
289:           <span class="ruby-identifier">edge_nb</span> = <span class="ruby-identifier">add_edges</span>(<span class="ruby-keyword kw">self</span>, <span class="ruby-identifier">fd</span>, <span class="ruby-identifier">object</span>, <span class="ruby-identifier">edge_nb</span>)
290:         }
291:         
292:         <span class="ruby-identifier">fd</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">'&lt;/graph&gt;'</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot;\n&quot;</span>
293:         <span class="ruby-identifier">fd</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">'&lt;/graphml&gt;'</span>
294:         
295:       <span class="ruby-keyword kw">ensure</span>
296:         <span class="ruby-identifier">fd</span>.<span class="ruby-identifier">close</span>
297:       <span class="ruby-keyword kw">end</span>
298:       
299:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000332" class="method-detail">
        <a name="M000332"></a>

        <div class="method-heading">
          <a href="#M000332" class="method-signature">
          <span class="method-name">filesize</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns the virtual file size as it would be taking on disk.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000332-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000332-source">
<pre>
     <span class="ruby-comment cmt"># File sources/parser/pdf.rb, line 193</span>
193:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">filesize</span>
194:       <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">to_bin</span>(<span class="ruby-identifier">:rebuildxrefs</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">false</span>).<span class="ruby-identifier">size</span>
195:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000338" class="method-detail">
        <a name="M000338"></a>

        <div class="method-heading">
          <a href="#M000338" class="method-signature">
          <span class="method-name">find</span><span class="method-args">(params = {}, &amp;b)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns an array of <a href="PDF.html#M000339">objects</a> matching
specified block.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000338-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000338-source">
<pre>
     <span class="ruby-comment cmt"># File sources/parser/pdf.rb, line 309</span>
309:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span> = {}, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">b</span>)
310:       
311:       <span class="ruby-identifier">options</span> =
312:       {
313:         <span class="ruby-identifier">:only_indirect</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">false</span>
314:       }
315:       <span class="ruby-identifier">options</span>.<span class="ruby-identifier">update</span>(<span class="ruby-identifier">params</span>)
316:       
317:       <span class="ruby-identifier">objset</span> = (<span class="ruby-identifier">options</span>[<span class="ruby-identifier">:only_indirect</span>] <span class="ruby-operator">==</span> <span class="ruby-keyword kw">true</span>) <span class="ruby-operator">?</span> 
318:         <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">indirect_objects</span>.<span class="ruby-identifier">values</span> <span class="ruby-operator">:</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">objects</span>
319: 
320:       <span class="ruby-identifier">objset</span>.<span class="ruby-identifier">find_all</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">b</span>)
321:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000378" class="method-detail">
        <a name="M000378"></a>

        <div class="method-heading">
          <a href="#M000378" class="method-signature">
          <span class="method-name">get_document_info</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns the document information dictionary if present.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000378-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000378-source">
<pre>
    <span class="ruby-comment cmt"># File sources/parser/metadata.rb, line 49</span>
49:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">get_document_info</span>
50:       <span class="ruby-identifier">get_doc_attr</span> <span class="ruby-identifier">:Info</span>
51:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000379" class="method-detail">
        <a name="M000379"></a>

        <div class="method-heading">
          <a href="#M000379" class="method-signature">
          <span class="method-name">get_metadata</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns a Hash of the information found in the metadata stream
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000379-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000379-source">
<pre>
    <span class="ruby-comment cmt"># File sources/parser/metadata.rb, line 56</span>
56:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">get_metadata</span>
57:       <span class="ruby-identifier">metadata_stm</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-constant">Catalog</span>.<span class="ruby-constant">Metadata</span>
58: 
59:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">metadata_stm</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Stream</span>)
60:         <span class="ruby-identifier">doc</span> = <span class="ruby-constant">REXML</span><span class="ruby-operator">::</span><span class="ruby-constant">Document</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">metadata_stm</span>.<span class="ruby-identifier">data</span>)
61: 
62:         <span class="ruby-identifier">info</span> = {}
63: 
64:         <span class="ruby-identifier">doc</span>.<span class="ruby-identifier">elements</span>.<span class="ruby-identifier">each</span>(<span class="ruby-value str">'*/*/rdf:Description'</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">description</span><span class="ruby-operator">|</span>
65:           
66:           <span class="ruby-identifier">description</span>.<span class="ruby-identifier">attributes</span>.<span class="ruby-identifier">each_attribute</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">attr</span><span class="ruby-operator">|</span>
67:             <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">attr</span>.<span class="ruby-identifier">prefix</span>
68:               <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'pdf'</span>,<span class="ruby-value str">'xap'</span>,<span class="ruby-value str">'pdf'</span>
69:                 <span class="ruby-identifier">info</span>[<span class="ruby-identifier">attr</span>.<span class="ruby-identifier">name</span>] = <span class="ruby-identifier">attr</span>.<span class="ruby-identifier">value</span>
70:             <span class="ruby-keyword kw">end</span>
71:           <span class="ruby-keyword kw">end</span>
72: 
73:           <span class="ruby-identifier">description</span>.<span class="ruby-identifier">elements</span>.<span class="ruby-identifier">each</span>(<span class="ruby-value str">'*'</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">element</span><span class="ruby-operator">|</span>
74:             <span class="ruby-identifier">value</span> = (<span class="ruby-identifier">element</span>.<span class="ruby-identifier">elements</span>[<span class="ruby-value str">'.//rdf:li'</span>] <span class="ruby-operator">||</span> <span class="ruby-identifier">element</span>).<span class="ruby-identifier">text</span>
75:             <span class="ruby-identifier">info</span>[<span class="ruby-identifier">element</span>.<span class="ruby-identifier">name</span>] = <span class="ruby-identifier">value</span>.<span class="ruby-identifier">to_s</span>
76:           <span class="ruby-keyword kw">end</span>
77: 
78:         <span class="ruby-keyword kw">end</span>
79: 
80:         <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">info</span>
81:       <span class="ruby-keyword kw">end</span>
82:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000336" class="method-detail">
        <a name="M000336"></a>

        <div class="method-heading">
          <a href="#M000336" class="method-signature">
          <span class="method-name">grep</span><span class="method-args">(*patterns)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns an array of Objects whose content is matching <em>pattern</em>.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000336-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000336-source">
<pre>
     <span class="ruby-comment cmt"># File sources/parser/pdf.rb, line 255</span>
255:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">grep</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">patterns</span>)
256: 
257:       <span class="ruby-identifier">patterns</span>.<span class="ruby-identifier">map!</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">pattern</span><span class="ruby-operator">|</span>
258:         <span class="ruby-identifier">pattern</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-operator">::</span><span class="ruby-constant">String</span>) <span class="ruby-operator">?</span> <span class="ruby-constant">Regexp</span>.<span class="ruby-identifier">new</span>(<span class="ruby-constant">Regexp</span>.<span class="ruby-identifier">escape</span>(<span class="ruby-identifier">pattern</span>)) <span class="ruby-operator">:</span> <span class="ruby-identifier">pattern</span>
259:       <span class="ruby-keyword kw">end</span>
260: 
261:       <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">patterns</span>.<span class="ruby-identifier">all?</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">pattern</span><span class="ruby-operator">|</span> <span class="ruby-identifier">pattern</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Regexp</span>) }
262:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">TypeError</span>, <span class="ruby-value str">&quot;Expected a String or Regexp&quot;</span>
263:       <span class="ruby-keyword kw">end</span>
264: 
265:       <span class="ruby-identifier">result</span> = []
266:       <span class="ruby-identifier">objects</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">obj</span><span class="ruby-operator">|</span>
267:         <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">obj</span>
268:           <span class="ruby-keyword kw">when</span> <span class="ruby-constant">String</span>, <span class="ruby-constant">Name</span>
269:             <span class="ruby-identifier">result</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">obj</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">patterns</span>.<span class="ruby-identifier">any?</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">pattern</span><span class="ruby-operator">|</span> <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">value</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">match</span>(<span class="ruby-identifier">pattern</span>)}
270:           <span class="ruby-keyword kw">when</span> <span class="ruby-constant">Stream</span>
271:             <span class="ruby-identifier">result</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">obj</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">patterns</span>.<span class="ruby-identifier">any?</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">pattern</span><span class="ruby-operator">|</span> <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">data</span>.<span class="ruby-identifier">match</span>(<span class="ruby-identifier">pattern</span>)}
272:         <span class="ruby-keyword kw">end</span>
273:       <span class="ruby-keyword kw">end</span>
274: 
275:       <span class="ruby-identifier">result</span>
276:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000376" class="method-detail">
        <a name="M000376"></a>

        <div class="method-heading">
          <a href="#M000376" class="method-signature">
          <span class="method-name">has_document_info?</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns true if the document has a document information dictionary.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000376-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000376-source">
<pre>
    <span class="ruby-comment cmt"># File sources/parser/metadata.rb, line 35</span>
35:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">has_document_info?</span>
36:       <span class="ruby-identifier">has_attr?</span> <span class="ruby-identifier">:Info</span> 
37:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000363" class="method-detail">
        <a name="M000363"></a>

        <div class="method-heading">
          <a href="#M000363" class="method-signature">
          <span class="method-name">has_form?</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns true if the document contains an acrobat form.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000363-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000363-source">
<pre>
    <span class="ruby-comment cmt"># File sources/parser/acroform.rb, line 33</span>
33:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">has_form?</span>
34:       <span class="ruby-keyword kw">not</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-constant">Catalog</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-keyword kw">and</span> <span class="ruby-keyword kw">not</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-constant">Catalog</span>.<span class="ruby-identifier">has_field?</span> <span class="ruby-identifier">:AcroForm</span>
35:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000377" class="method-detail">
        <a name="M000377"></a>

        <div class="method-heading">
          <a href="#M000377" class="method-signature">
          <span class="method-name">has_metadata?</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns true if the document has a catalog metadata stream.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000377-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000377-source">
<pre>
    <span class="ruby-comment cmt"># File sources/parser/metadata.rb, line 42</span>
42:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">has_metadata?</span>
43:       <span class="ruby-keyword kw">self</span>.<span class="ruby-constant">Catalog</span>.<span class="ruby-identifier">has_key?</span> <span class="ruby-identifier">:Metadata</span> 
44:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000358" class="method-detail">
        <a name="M000358"></a>

        <div class="method-heading">
          <a href="#M000358" class="method-signature">
          <span class="method-name">has_usage_rights?</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000358-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000358-source">
<pre>
     <span class="ruby-comment cmt"># File sources/parser/signature.rb, line 217</span>
217:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">has_usage_rights?</span>
218:       
219:       <span class="ruby-comment cmt">#~ not self.Catalog.Perms.nil? and (not self.Catalog.Perms.UR3.nil? or not self.Catalog.Perms.UR.nil?)</span>
220:       <span class="ruby-value str">&quot;todo&quot;</span>
221:       
222:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000341" class="method-detail">
        <a name="M000341"></a>

        <div class="method-heading">
          <a href="#M000341" class="method-signature">
          <span class="method-name">indirect_objects</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Return an hash of indirect <a href="PDF.html#M000339">objects</a>. Updated
<a href="PDF.html#M000339">objects</a> appear only once.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000341-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000341-source">
<pre>
     <span class="ruby-comment cmt"># File sources/parser/pdf.rb, line 363</span>
363:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">indirect_objects</span>
364:       <span class="ruby-ivar">@revisions</span>.<span class="ruby-identifier">inject</span>({}) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">set</span>, <span class="ruby-identifier">rev</span><span class="ruby-operator">|</span> <span class="ruby-identifier">set</span>.<span class="ruby-identifier">merge</span>(<span class="ruby-identifier">rev</span>.<span class="ruby-identifier">body</span>) <span class="ruby-keyword kw">end</span>
365:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000373" class="method-detail">
        <a name="M000373"></a>

        <div class="method-heading">
          <a href="#M000373" class="method-signature">
          <span class="method-name">insert_page</span><span class="method-args">(index, page)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000373-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000373-source">
<pre>
    <span class="ruby-comment cmt"># File sources/parser/page.rb, line 45</span>
45:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">insert_page</span>(<span class="ruby-identifier">index</span>, <span class="ruby-identifier">page</span>)
46:       
47:       <span class="ruby-identifier">treeroot</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-constant">Catalog</span>.<span class="ruby-constant">Pages</span>
48:       <span class="ruby-identifier">raise</span> <span class="ruby-constant">InvalidPDF</span>, <span class="ruby-value str">&quot;No page tree&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">treeroot</span>.<span class="ruby-identifier">nil?</span>
49: 
50:       <span class="ruby-identifier">treeroot</span>.<span class="ruby-identifier">insert_page</span>(<span class="ruby-identifier">index</span>, <span class="ruby-identifier">page</span>)
51: 
52:       <span class="ruby-keyword kw">self</span>
53:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000325" class="method-detail">
        <a name="M000325"></a>

        <div class="method-heading">
          <a href="#M000325" class="method-signature">
          <span class="method-name">is_encrypted?</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns whether the <a href="PDF.html">PDF</a> file is encrypted.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000325-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000325-source">
<pre>
    <span class="ruby-comment cmt"># File sources/parser/encryption.rb, line 45</span>
45:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">is_encrypted?</span>
46:       <span class="ruby-identifier">has_attr?</span> <span class="ruby-identifier">:Encrypt</span>
47:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000359" class="method-detail">
        <a name="M000359"></a>

        <div class="method-heading">
          <a href="#M000359" class="method-signature">
          <span class="method-name">is_linearized?</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns whether the current document is linearized.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000359-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000359-source">
<pre>
    <span class="ruby-comment cmt"># File sources/parser/linearization.rb, line 33</span>
33:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">is_linearized?</span>
34:       <span class="ruby-identifier">obj</span> = <span class="ruby-ivar">@revisions</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">body</span>.<span class="ruby-identifier">values</span>.<span class="ruby-identifier">first</span>
35:       
36:       <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Dictionary</span>) <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">has_key?</span> <span class="ruby-identifier">:Linearized</span>
37:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000356" class="method-detail">
        <a name="M000356"></a>

        <div class="method-heading">
          <a href="#M000356" class="method-signature">
          <span class="method-name">is_signed?</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns whether the document contains a digital signature.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000356-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000356-source">
<pre>
     <span class="ruby-comment cmt"># File sources/parser/signature.rb, line 119</span>
119:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">is_signed?</span>
120:       
121:       <span class="ruby-comment cmt">#~ not self.Catalog.AcroForm.nil? and (self.Catalog.AcroForm[:SigFlags] &amp; InteractiveForm::SigFlags::SIGNATUREEXISTS) != 0</span>
122:       <span class="ruby-value str">&quot;todo&quot;</span>
123:       
124:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000337" class="method-detail">
        <a name="M000337"></a>

        <div class="method-heading">
          <a href="#M000337" class="method-signature">
          <span class="method-name">ls</span><span class="method-args">(*patterns)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns an array of Objects whose name (in a <a
href="Dictionary.html">Dictionary</a>) is matching <em>pattern</em>.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000337-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000337-source">
<pre>
     <span class="ruby-comment cmt"># File sources/parser/pdf.rb, line 281</span>
281:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">ls</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">patterns</span>)
282:     
283:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">patterns</span>.<span class="ruby-identifier">empty?</span>
284:         <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">objects</span>
285:       <span class="ruby-keyword kw">end</span>
286: 
287:       <span class="ruby-identifier">result</span> = []
288: 
289:       <span class="ruby-identifier">patterns</span>.<span class="ruby-identifier">map!</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">pattern</span><span class="ruby-operator">|</span>
290:         <span class="ruby-identifier">pattern</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-operator">::</span><span class="ruby-constant">String</span>) <span class="ruby-operator">?</span> <span class="ruby-constant">Regexp</span>.<span class="ruby-identifier">new</span>(<span class="ruby-constant">Regexp</span>.<span class="ruby-identifier">escape</span>(<span class="ruby-identifier">pattern</span>)) <span class="ruby-operator">:</span> <span class="ruby-identifier">pattern</span>
291:       <span class="ruby-keyword kw">end</span>
292: 
293:       <span class="ruby-identifier">objects</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">obj</span><span class="ruby-operator">|</span>
294:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Dictionary</span>)
295:           <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">each_pair</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">name</span>, <span class="ruby-identifier">obj</span><span class="ruby-operator">|</span>
296:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">patterns</span>.<span class="ruby-identifier">any?</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">pattern</span><span class="ruby-operator">|</span> <span class="ruby-identifier">name</span>.<span class="ruby-identifier">value</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">match</span>(<span class="ruby-identifier">pattern</span>) }
297:               <span class="ruby-identifier">result</span> <span class="ruby-operator">&lt;&lt;</span> ( <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Reference</span>) <span class="ruby-operator">?</span> <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">solve</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">obj</span> )
298:             <span class="ruby-keyword kw">end</span>
299:           <span class="ruby-keyword kw">end</span>
300:         <span class="ruby-keyword kw">end</span>
301:       <span class="ruby-keyword kw">end</span>
302: 
303:       <span class="ruby-identifier">result</span>
304:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000375" class="method-detail">
        <a name="M000375"></a>

        <div class="method-heading">
          <a href="#M000375" class="method-signature">
          <span class="method-name">obfuscate_and_saveas</span><span class="method-args">(filename, options = {})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000375-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000375-source">
<pre>
     <span class="ruby-comment cmt"># File sources/parser/obfuscation.rb, line 216</span>
216:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">obfuscate_and_saveas</span>(<span class="ruby-identifier">filename</span>, <span class="ruby-identifier">options</span> = {})
217:       <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:obfuscate</span>] = <span class="ruby-keyword kw">true</span>
218:       <span class="ruby-identifier">saveas</span>(<span class="ruby-identifier">filename</span>, <span class="ruby-identifier">options</span>)
219:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000339" class="method-detail">
        <a name="M000339"></a>

        <div class="method-heading">
          <a href="#M000339" class="method-signature">
          <span class="method-name">objects</span><span class="method-args">(include_objstm = true)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns an array of <a href="PDF.html#M000339">objects</a> embedded in the
<a href="PDF.html">PDF</a> body.
</p>
<table>
<tr><td valign="top"><em>include_objstm</em>:</td><td>Whether it shall return <a href="PDF.html#M000339">objects</a> embedded in
object streams.

</td></tr>
</table>
<p>
Note : Shall return to an iterator for Ruby 1.9 comp.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000339-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000339-source">
<pre>
     <span class="ruby-comment cmt"># File sources/parser/pdf.rb, line 328</span>
328:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">objects</span>(<span class="ruby-identifier">include_objstm</span> = <span class="ruby-keyword kw">true</span>)
329:       
330:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">append_subobj</span>(<span class="ruby-identifier">root</span>, <span class="ruby-identifier">objset</span>, <span class="ruby-identifier">inc_objstm</span>)
331:         
332:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">objset</span>.<span class="ruby-identifier">find</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">o</span><span class="ruby-operator">|</span> <span class="ruby-identifier">root</span>.<span class="ruby-identifier">equal?</span>(<span class="ruby-identifier">o</span>) }.<span class="ruby-identifier">nil?</span>
333:           
334:           <span class="ruby-identifier">objset</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">root</span>
335: 
336:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">root</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Dictionary</span>)
337:             <span class="ruby-identifier">root</span>.<span class="ruby-identifier">each_pair</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">name</span>, <span class="ruby-identifier">value</span><span class="ruby-operator">|</span>
338:               <span class="ruby-identifier">append_subobj</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">objset</span>, <span class="ruby-identifier">inc_objstm</span>)
339:               <span class="ruby-identifier">append_subobj</span>(<span class="ruby-identifier">value</span>, <span class="ruby-identifier">objset</span>, <span class="ruby-identifier">inc_objstm</span>)
340:             }
341:           <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">root</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Array</span>) <span class="ruby-keyword kw">or</span> (<span class="ruby-identifier">root</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">ObjectStream</span>) <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">inc_objstm</span> <span class="ruby-operator">==</span> <span class="ruby-keyword kw">true</span>)
342:             <span class="ruby-identifier">root</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">subobj</span><span class="ruby-operator">|</span> <span class="ruby-identifier">append_subobj</span>(<span class="ruby-identifier">subobj</span>, <span class="ruby-identifier">objset</span>, <span class="ruby-identifier">inc_objstm</span>) }
343:           <span class="ruby-keyword kw">end</span>
344:         
345:         <span class="ruby-keyword kw">end</span>
346:         
347:       <span class="ruby-keyword kw">end</span>
348:       
349:       <span class="ruby-identifier">objset</span> = []
350:       <span class="ruby-ivar">@revisions</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">revision</span><span class="ruby-operator">|</span>
351:         <span class="ruby-identifier">revision</span>.<span class="ruby-identifier">body</span>.<span class="ruby-identifier">each_value</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">object</span><span class="ruby-operator">|</span>
352:             <span class="ruby-identifier">append_subobj</span>(<span class="ruby-identifier">object</span>, <span class="ruby-identifier">objset</span>, <span class="ruby-identifier">include_objstm</span>)
353:         }
354:       }
355:       
356:       <span class="ruby-identifier">objset</span>
357:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000369" class="method-detail">
        <a name="M000369"></a>

        <div class="method-heading">
          <a href="#M000369" class="method-signature">
          <span class="method-name">onDocumentClose</span><span class="method-args">(action)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Sets an action to run on document closing.
</p>
<table>
<tr><td valign="top"><em>action</em>:</td><td>A JavaScript <a href="Action.html">Action</a> <a
href="Object.html">Object</a>.

</td></tr>
</table>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000369-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000369-source">
<pre>
    <span class="ruby-comment cmt"># File sources/parser/catalog.rb, line 76</span>
76:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">onDocumentClose</span>(<span class="ruby-identifier">action</span>)
77:       
78:       <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">action</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Action</span><span class="ruby-operator">::</span><span class="ruby-constant">JavaScript</span>)
79:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">TypeError</span>, <span class="ruby-value str">&quot;An Action::JavaScript object must be passed.&quot;</span>
80:       <span class="ruby-keyword kw">end</span>
81:       
82:       <span class="ruby-keyword kw">unless</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-constant">Catalog</span>
83:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">InvalidPDF</span>, <span class="ruby-value str">&quot;A catalog object must exist to add this action.&quot;</span>
84:       <span class="ruby-keyword kw">end</span>
85:       
86:       <span class="ruby-keyword kw">self</span>.<span class="ruby-constant">Catalog</span>.<span class="ruby-constant">AA</span> <span class="ruby-operator">||=</span> <span class="ruby-constant">CatalogAdditionalActions</span>.<span class="ruby-identifier">new</span>
87:       <span class="ruby-keyword kw">self</span>.<span class="ruby-constant">Catalog</span>.<span class="ruby-constant">AA</span>.<span class="ruby-constant">WC</span> = <span class="ruby-identifier">action</span>
88:       
89:       <span class="ruby-keyword kw">self</span>
90:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000368" class="method-detail">
        <a name="M000368"></a>

        <div class="method-heading">
          <a href="#M000368" class="method-signature">
          <span class="method-name">onDocumentOpen</span><span class="method-args">(action)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Sets an action to run on document opening.
</p>
<table>
<tr><td valign="top"><em>action</em>:</td><td>An <a href="Action.html">Action</a> <a href="Object.html">Object</a>.

</td></tr>
</table>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000368-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000368-source">
<pre>
    <span class="ruby-comment cmt"># File sources/parser/catalog.rb, line 57</span>
57:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">onDocumentOpen</span>(<span class="ruby-identifier">action</span>)   
58:       
59:       <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">action</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Action</span><span class="ruby-operator">::</span><span class="ruby-constant">Action</span>)
60:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">TypeError</span>, <span class="ruby-value str">&quot;An Action object must be passed.&quot;</span>
61:       <span class="ruby-keyword kw">end</span>
62:       
63:       <span class="ruby-keyword kw">unless</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-constant">Catalog</span>
64:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">InvalidPDF</span>, <span class="ruby-value str">&quot;A catalog object must exist to add this action.&quot;</span>
65:       <span class="ruby-keyword kw">end</span>
66:       
67:       <span class="ruby-keyword kw">self</span>.<span class="ruby-constant">Catalog</span>.<span class="ruby-constant">OpenAction</span> = <span class="ruby-identifier">action</span>
68:       
69:       <span class="ruby-keyword kw">self</span>
70:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000370" class="method-detail">
        <a name="M000370"></a>

        <div class="method-heading">
          <a href="#M000370" class="method-signature">
          <span class="method-name">onDocumentPrint</span><span class="method-args">(action)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Sets an action to run on document printing.
</p>
<table>
<tr><td valign="top"><em>action</em>:</td><td>A JavaScript <a href="Action.html">Action</a> <a
href="Object.html">Object</a>.

</td></tr>
</table>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000370-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000370-source">
<pre>
     <span class="ruby-comment cmt"># File sources/parser/catalog.rb, line 96</span>
 96:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">onDocumentPrint</span>(<span class="ruby-identifier">action</span>)
 97:       
 98:       <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">action</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Action</span><span class="ruby-operator">::</span><span class="ruby-constant">JavaScript</span>)
 99:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">TypeError</span>, <span class="ruby-value str">&quot;An Action::JavaScript object must be passed.&quot;</span>
100:       <span class="ruby-keyword kw">end</span>
101:       
102:       <span class="ruby-keyword kw">unless</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-constant">Catalog</span>
103:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">InvalidPDF</span>, <span class="ruby-value str">&quot;A catalog object must exist to add this action.&quot;</span>
104:       <span class="ruby-keyword kw">end</span>
105:       
106:       <span class="ruby-keyword kw">self</span>.<span class="ruby-constant">Catalog</span>.<span class="ruby-constant">AA</span> <span class="ruby-operator">||=</span> <span class="ruby-constant">CatalogAdditionalActions</span>.<span class="ruby-identifier">new</span>
107:       <span class="ruby-keyword kw">self</span>.<span class="ruby-constant">Catalog</span>.<span class="ruby-constant">AA</span>.<span class="ruby-constant">WP</span> = <span class="ruby-identifier">action</span>
108:       
109:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000374" class="method-detail">
        <a name="M000374"></a>

        <div class="method-heading">
          <a href="#M000374" class="method-signature">
          <span class="method-name">pages</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns an array of <a href="Page.html">Page</a>
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000374-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000374-source">
<pre>
    <span class="ruby-comment cmt"># File sources/parser/page.rb, line 58</span>
58:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">pages</span>
59:       
60:       <span class="ruby-keyword kw">return</span> [] <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">not</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-constant">Catalog</span> <span class="ruby-keyword kw">or</span> <span class="ruby-keyword kw">not</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-constant">Catalog</span>.<span class="ruby-constant">Pages</span>
61:       
62:       <span class="ruby-identifier">root</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-constant">Catalog</span>.<span class="ruby-constant">Pages</span>
63:       <span class="ruby-keyword kw">return</span> [] <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">root</span>.<span class="ruby-identifier">nil?</span>
64: 
65:       <span class="ruby-identifier">root</span>.<span class="ruby-identifier">solve</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">root</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Reference</span>) 
66: 
67:       <span class="ruby-identifier">root</span>.<span class="ruby-identifier">children</span>
68:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000351" class="method-detail">
        <a name="M000351"></a>

        <div class="method-heading">
          <a href="#M000351" class="method-signature">
          <span class="method-name">physicalize</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Converts a logical <a href="PDF.html">PDF</a> view into a physical view
ready for writing.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000351-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000351-source">
<pre>
     <span class="ruby-comment cmt"># File sources/parser/pdf.rb, line 780</span>
780:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">physicalize</span>
781:      
782:       <span class="ruby-comment cmt">#</span>
783:       <span class="ruby-comment cmt"># Indirect objects are added to the revision and assigned numbers.</span>
784:       <span class="ruby-comment cmt">#</span>
785:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">build</span>(<span class="ruby-identifier">obj</span>, <span class="ruby-identifier">revision</span>) <span class="ruby-comment cmt">#:nodoc:</span>
786: 
787:         <span class="ruby-comment cmt">#</span>
788:         <span class="ruby-comment cmt"># Finalize any subobjects before building the stream.</span>
789:         <span class="ruby-comment cmt">#</span>
790:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">ObjectStream</span>)
791:           <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">subobj</span><span class="ruby-operator">|</span>
792:             <span class="ruby-identifier">build</span>(<span class="ruby-identifier">subobj</span>, <span class="ruby-identifier">revision</span>)
793:           }
794:         <span class="ruby-keyword kw">end</span>
795:   
796:         <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">pre_build</span>
797: 
798:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Dictionary</span>) <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Array</span>)
799:             
800:             <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">map!</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">subobj</span><span class="ruby-operator">|</span>
801:               <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">subobj</span>.<span class="ruby-identifier">is_indirect?</span>
802:                 <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">get_object</span>(<span class="ruby-identifier">subobj</span>.<span class="ruby-identifier">reference</span>)
803:                   <span class="ruby-identifier">subobj</span>.<span class="ruby-identifier">reference</span>
804:                 <span class="ruby-keyword kw">else</span>
805:                   <span class="ruby-identifier">ref</span> = <span class="ruby-identifier">add_to_revision</span>(<span class="ruby-identifier">subobj</span>, <span class="ruby-identifier">revision</span>)
806:                   <span class="ruby-identifier">build</span>(<span class="ruby-identifier">subobj</span>, <span class="ruby-identifier">revision</span>)
807:                   <span class="ruby-identifier">ref</span>
808:                 <span class="ruby-keyword kw">end</span>
809:               <span class="ruby-keyword kw">else</span>
810:                 <span class="ruby-identifier">subobj</span>
811:               <span class="ruby-keyword kw">end</span>
812:             }
813:             
814:             <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">subobj</span><span class="ruby-operator">|</span>
815:               <span class="ruby-identifier">build</span>(<span class="ruby-identifier">subobj</span>, <span class="ruby-identifier">revision</span>)
816:             }
817:             
818:         <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Stream</span>)
819:           <span class="ruby-identifier">build</span>(<span class="ruby-identifier">obj</span>.<span class="ruby-identifier">dictionary</span>, <span class="ruby-identifier">revision</span>)
820:         <span class="ruby-keyword kw">end</span>
821: 
822:         <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">post_build</span>
823:         
824:       <span class="ruby-keyword kw">end</span>
825:       
826:       <span class="ruby-identifier">all_indirect_objects</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">obj</span>, <span class="ruby-identifier">revision</span><span class="ruby-operator">|</span>
827:           <span class="ruby-identifier">build</span>(<span class="ruby-identifier">obj</span>, <span class="ruby-identifier">revision</span>)          
828:       }
829:       
830:       <span class="ruby-keyword kw">self</span>
831:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000347" class="method-detail">
        <a name="M000347"></a>

        <div class="method-heading">
          <a href="#M000347" class="method-signature">
          <span class="method-name">rebuildxrefs</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Compute and update <a href="XRef/Section.html">XRef::Section</a> for each
<a href="PDF/Revision.html">Revision</a>.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000347-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000347-source">
<pre>
     <span class="ruby-comment cmt"># File sources/parser/pdf.rb, line 626</span>
626:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">rebuildxrefs</span>
627:       
628:       <span class="ruby-identifier">size</span> = <span class="ruby-value">0</span>
629:       <span class="ruby-identifier">startxref</span> = <span class="ruby-ivar">@header</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">size</span>
630:       
631:       <span class="ruby-ivar">@revisions</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">revision</span><span class="ruby-operator">|</span>
632:       
633:         <span class="ruby-identifier">revision</span>.<span class="ruby-identifier">body</span>.<span class="ruby-identifier">each_value</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">object</span><span class="ruby-operator">|</span>
634:           <span class="ruby-identifier">startxref</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">object</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">size</span>
635:         }
636:         
637:         <span class="ruby-identifier">size</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">revision</span>.<span class="ruby-identifier">body</span>.<span class="ruby-identifier">size</span>
638:         <span class="ruby-identifier">revision</span>.<span class="ruby-identifier">xreftable</span> = <span class="ruby-identifier">buildxrefs</span>(<span class="ruby-identifier">revision</span>.<span class="ruby-identifier">body</span>.<span class="ruby-identifier">values</span>)
639:         
640:         <span class="ruby-identifier">revision</span>.<span class="ruby-identifier">trailer</span> <span class="ruby-operator">||=</span> <span class="ruby-constant">Trailer</span>.<span class="ruby-identifier">new</span>
641:         <span class="ruby-identifier">revision</span>.<span class="ruby-identifier">trailer</span>.<span class="ruby-constant">Size</span> = <span class="ruby-identifier">size</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>
642:         <span class="ruby-identifier">revision</span>.<span class="ruby-identifier">trailer</span>.<span class="ruby-identifier">startxref</span> = <span class="ruby-identifier">startxref</span>
643:         
644:         <span class="ruby-identifier">startxref</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">revision</span>.<span class="ruby-identifier">xreftable</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">revision</span>.<span class="ruby-identifier">trailer</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">size</span>
645:       }
646:       
647:       <span class="ruby-keyword kw">self</span>
648:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000371" class="method-detail">
        <a name="M000371"></a>

        <div class="method-heading">
          <a href="#M000371" class="method-signature">
          <span class="method-name">register</span><span class="method-args">(root, name, value)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Registers an object into a specific Names root dictionary.
</p>
<table>
<tr><td valign="top"><em>root</em>:</td><td>The root dictionary (see <a href="Names/Root.html">Names::Root</a>)

</td></tr>
<tr><td valign="top"><em>name</em>:</td><td>The value name.

</td></tr>
<tr><td valign="top"><em>value</em>:</td><td>The value to associate with this name.

</td></tr>
</table>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000371-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000371-source">
<pre>
     <span class="ruby-comment cmt"># File sources/parser/catalog.rb, line 117</span>
117:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">register</span>(<span class="ruby-identifier">root</span>, <span class="ruby-identifier">name</span>, <span class="ruby-identifier">value</span>)
118:       
119:       <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-constant">Catalog</span>.<span class="ruby-constant">Names</span>.<span class="ruby-identifier">nil?</span>
120:         <span class="ruby-keyword kw">self</span>.<span class="ruby-constant">Catalog</span>.<span class="ruby-constant">Names</span> = <span class="ruby-constant">Names</span>.<span class="ruby-identifier">new</span>
121:       <span class="ruby-keyword kw">end</span>
122:       
123:       <span class="ruby-identifier">value</span>.<span class="ruby-identifier">set_indirect</span>(<span class="ruby-keyword kw">true</span>)
124:       
125:       <span class="ruby-identifier">namesroot</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-constant">Catalog</span>.<span class="ruby-constant">Names</span>.<span class="ruby-identifier">send</span>(<span class="ruby-identifier">root</span>)
126:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">namesroot</span>.<span class="ruby-identifier">nil?</span>
127:         <span class="ruby-identifier">names</span> = <span class="ruby-constant">NameTreeNode</span>.<span class="ruby-identifier">new</span>({<span class="ruby-identifier">:Names</span> =<span class="ruby-operator">&gt;</span> [] })
128:         <span class="ruby-keyword kw">self</span>.<span class="ruby-constant">Catalog</span>.<span class="ruby-constant">Names</span>.<span class="ruby-identifier">send</span>((<span class="ruby-identifier">root</span>.<span class="ruby-identifier">id2name</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;=&quot;</span>).<span class="ruby-identifier">to_sym</span>, (<span class="ruby-keyword kw">self</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">names</span>))
129:         <span class="ruby-identifier">names</span>.<span class="ruby-constant">Names</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">name</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">value</span>
130:       <span class="ruby-keyword kw">else</span>
131:         <span class="ruby-identifier">namesroot</span>.<span class="ruby-constant">Names</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">name</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">value</span>
132:       <span class="ruby-keyword kw">end</span>
133:       
134:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000349" class="method-detail">
        <a name="M000349"></a>

        <div class="method-heading">
          <a href="#M000349" class="method-signature">
          <span class="method-name">remove_revision</span><span class="method-args">(index)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Removes a whole document revision.
</p>
<table>
<tr><td valign="top"><em>index</em>:</td><td><a href="PDF/Revision.html">Revision</a> index, first is 0.

</td></tr>
</table>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000349-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000349-source">
<pre>
     <span class="ruby-comment cmt"># File sources/parser/pdf.rb, line 668</span>
668:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">remove_revision</span>(<span class="ruby-identifier">index</span>)
669:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">index</span> <span class="ruby-operator">&lt;</span> <span class="ruby-value">0</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">index</span> <span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@revisions</span>.<span class="ruby-identifier">size</span>
670:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">IndexError</span>, <span class="ruby-value str">&quot;Not a valid revision index&quot;</span>
671:       <span class="ruby-keyword kw">end</span>
672: 
673:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@revisions</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">==</span> <span class="ruby-value">1</span>
674:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">InvalidPDF</span>, <span class="ruby-value str">&quot;Cannot remove last revision&quot;</span>
675:       <span class="ruby-keyword kw">end</span>
676: 
677:       <span class="ruby-ivar">@revisions</span>.<span class="ruby-identifier">delete_at</span>(<span class="ruby-identifier">index</span>)
678:       <span class="ruby-keyword kw">self</span>
679:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000353" class="method-detail">
        <a name="M000353"></a>

        <div class="method-heading">
          <a href="#M000353" class="method-signature">
          <span class="method-name">remove_xrefs</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Tries to strip any xrefs information off the document.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000353-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000353-source">
<pre>
    <span class="ruby-comment cmt"># File sources/parser/xreftable.rb, line 29</span>
29:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">remove_xrefs</span>
30:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">delete_xrefstm</span>(<span class="ruby-identifier">xrefstm</span>)
31:         <span class="ruby-identifier">prev</span> = <span class="ruby-identifier">xrefstm</span>.<span class="ruby-constant">Prev</span>
32:         <span class="ruby-identifier">delete_object</span>(<span class="ruby-identifier">xrefstm</span>.<span class="ruby-identifier">reference</span>)
33: 
34:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">prev</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Integer</span>) <span class="ruby-keyword kw">and</span> (<span class="ruby-identifier">prev_stm</span> = <span class="ruby-identifier">get_object_by_offset</span>(<span class="ruby-identifier">prev</span>)).<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">XRefStream</span>)
35:           <span class="ruby-identifier">delete_xrefstm</span>(<span class="ruby-identifier">prev_stm</span>)
36:         <span class="ruby-keyword kw">end</span>
37:       <span class="ruby-keyword kw">end</span>
38: 
39:       <span class="ruby-ivar">@revisions</span>.<span class="ruby-identifier">reverse_each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">rev</span><span class="ruby-operator">|</span>
40:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">rev</span>.<span class="ruby-identifier">has_xrefstm?</span>
41:           <span class="ruby-identifier">delete_xrefstm</span>(<span class="ruby-identifier">rev</span>.<span class="ruby-identifier">xrefstm</span>)
42:         <span class="ruby-keyword kw">end</span>
43:         
44:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">rev</span>.<span class="ruby-identifier">trailer</span>.<span class="ruby-identifier">has_dictionary?</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">rev</span>.<span class="ruby-identifier">trailer</span>.<span class="ruby-constant">XRefStm</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Integer</span>)
45:           <span class="ruby-identifier">xrefstm</span> = <span class="ruby-identifier">get_object_by_offset</span>(<span class="ruby-identifier">rev</span>.<span class="ruby-identifier">trailer</span>.<span class="ruby-constant">XRefStm</span>)
46: 
47:           <span class="ruby-identifier">delete_xrefstm</span>(<span class="ruby-identifier">xrefstm</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">xrefstm</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">XRefStream</span>)
48:         <span class="ruby-keyword kw">end</span>
49: 
50:         <span class="ruby-identifier">rev</span>.<span class="ruby-identifier">xrefstm</span> = <span class="ruby-identifier">rev</span>.<span class="ruby-identifier">xreftable</span> = <span class="ruby-keyword kw">nil</span>
51:       <span class="ruby-keyword kw">end</span>
52:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000333" class="method-detail">
        <a name="M000333"></a>

        <div class="method-heading">
          <a href="#M000333" class="method-signature">
          <span class="method-name">save</span><span class="method-args">(file, params = {})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Saves the current file as its current filename.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000333-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000333-source">
<pre>
     <span class="ruby-comment cmt"># File sources/parser/pdf.rb, line 200</span>
200:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">save</span>(<span class="ruby-identifier">file</span>, <span class="ruby-identifier">params</span> = {})
201:       
202:       <span class="ruby-identifier">options</span> = 
203:       {
204:         <span class="ruby-identifier">:delinearize</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">false</span>,
205:         <span class="ruby-identifier">:recompile</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span>,
206:       }
207:       <span class="ruby-identifier">options</span>.<span class="ruby-identifier">update</span>(<span class="ruby-identifier">params</span>)
208: 
209:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">file</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-identifier">:write</span>)
210:         <span class="ruby-identifier">fd</span> = <span class="ruby-identifier">file</span>
211:       <span class="ruby-keyword kw">else</span>
212:         <span class="ruby-identifier">fd</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">open</span>(<span class="ruby-identifier">file</span>, <span class="ruby-value str">'w'</span>).<span class="ruby-identifier">binmode</span>
213:       <span class="ruby-keyword kw">end</span>
214:       
215:       <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">delinearize!</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:delinearize</span>] <span class="ruby-operator">==</span> <span class="ruby-keyword kw">true</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">is_linearized?</span>
216:       <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">compile</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:recompile</span>] <span class="ruby-operator">==</span> <span class="ruby-keyword kw">true</span>
217: 
218:       <span class="ruby-identifier">fd</span>.<span class="ruby-identifier">write</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">to_bin</span>(<span class="ruby-identifier">options</span>)
219:         
220:       <span class="ruby-identifier">fd</span>.<span class="ruby-identifier">close</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">file</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-identifier">:write</span>)
221:       
222:       <span class="ruby-keyword kw">self</span>
223:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000335" class="method-detail">
        <a name="M000335"></a>

        <div class="method-heading">
          <a href="#M000335" class="method-signature">
          <span class="method-name">save_upto</span><span class="method-args">(revision, filename)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Saves the file up to given revision number. This can be useful to visualize
the modifications over different incremental updates.
</p>
<table>
<tr><td valign="top"><em>revision</em>:</td><td>The revision number to <a href="PDF.html#M000333">save</a>.

</td></tr>
<tr><td valign="top"><em>filename</em>:</td><td>The path where to <a href="PDF.html#M000333">save</a> this <a
href="PDF.html">PDF</a>.

</td></tr>
</table>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000335-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000335-source">
<pre>
     <span class="ruby-comment cmt"># File sources/parser/pdf.rb, line 248</span>
248:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">save_upto</span>(<span class="ruby-identifier">revision</span>, <span class="ruby-identifier">filename</span>)
249:       <span class="ruby-identifier">saveas</span>(<span class="ruby-identifier">filename</span>, <span class="ruby-identifier">:up_to_revision</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">revision</span>)  
250:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000334" class="method-detail">
        <a name="M000334"></a>

        <div class="method-heading">
          <a href="#M000334" class="method-signature">
          <span class="method-name">saveas</span><span class="method-args">(filename, params = {})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Sets the current filename to the argument given, then <a
href="PDF.html#M000333">save</a> it.
</p>
<table>
<tr><td valign="top"><em>filename</em>:</td><td>The path where to <a href="PDF.html#M000333">save</a> this <a
href="PDF.html">PDF</a>.

</td></tr>
</table>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000334-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000334-source">
<pre>
     <span class="ruby-comment cmt"># File sources/parser/pdf.rb, line 229</span>
229:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">saveas</span>(<span class="ruby-identifier">filename</span>, <span class="ruby-identifier">params</span> = {})
230:       
231:       <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">frozen?</span>
232:         <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recompile</span>] = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:rebuildxrefs</span>] = <span class="ruby-keyword kw">false</span>
233:         <span class="ruby-identifier">save</span>(<span class="ruby-identifier">filename</span>, <span class="ruby-identifier">params</span>)
234:       <span class="ruby-keyword kw">else</span> 
235:         <span class="ruby-ivar">@filename</span> = <span class="ruby-identifier">filename</span>
236:         <span class="ruby-identifier">save</span>(<span class="ruby-identifier">filename</span>, <span class="ruby-identifier">params</span>)
237:       <span class="ruby-keyword kw">end</span>
238:       
239:       <span class="ruby-keyword kw">self</span>
240:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000331" class="method-detail">
        <a name="M000331"></a>

        <div class="method-heading">
          <a href="#M000331" class="method-signature">
          <span class="method-name">serialize</span><span class="method-args">(filename)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Serializes the current <a href="PDF.html">PDF</a>
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000331-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000331-source">
<pre>
     <span class="ruby-comment cmt"># File sources/parser/pdf.rb, line 182</span>
182:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">serialize</span>(<span class="ruby-identifier">filename</span>)
183:         <span class="ruby-constant">Zlib</span><span class="ruby-operator">::</span><span class="ruby-constant">GzipWriter</span>.<span class="ruby-identifier">open</span>(<span class="ruby-identifier">filename</span>) { <span class="ruby-operator">|</span><span class="ruby-identifier">gz</span><span class="ruby-operator">|</span>
184:           <span class="ruby-identifier">gz</span>.<span class="ruby-identifier">write</span> <span class="ruby-constant">Marshal</span>.<span class="ruby-identifier">dump</span>(<span class="ruby-keyword kw">self</span>)
185:         }
186:         
187:         <span class="ruby-keyword kw">self</span>
188:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000355" class="method-detail">
        <a name="M000355"></a>

        <div class="method-heading">
          <a href="#M000355" class="method-signature">
          <span class="method-name">sign</span><span class="method-args">(certificate, key, ca = [], annotation = nil, location = nil, contact = nil, reason = nil)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Sign the document with the given key and x509 certificate.
</p>
<table>
<tr><td valign="top"><em>certificate</em>:</td><td>The X509 certificate containing the public key.

</td></tr>
<tr><td valign="top"><em>key</em>:</td><td>The private key associated with the certificate.

</td></tr>
<tr><td valign="top"><em>ca</em>:</td><td>Optional CA certificates used to <a href="PDF.html#M000355">sign</a> the
user certificate.

</td></tr>
</table>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000355-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000355-source">
<pre>
     <span class="ruby-comment cmt"># File sources/parser/signature.rb, line 34</span>
 34:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">sign</span>(<span class="ruby-identifier">certificate</span>, <span class="ruby-identifier">key</span>, <span class="ruby-identifier">ca</span> = [], <span class="ruby-identifier">annotation</span> = <span class="ruby-keyword kw">nil</span>, <span class="ruby-identifier">location</span> = <span class="ruby-keyword kw">nil</span>, <span class="ruby-identifier">contact</span> = <span class="ruby-keyword kw">nil</span>, <span class="ruby-identifier">reason</span> = <span class="ruby-keyword kw">nil</span>)
 35:       
 36:       <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">certificate</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">OpenSSL</span><span class="ruby-operator">::</span><span class="ruby-constant">X509</span><span class="ruby-operator">::</span><span class="ruby-constant">Certificate</span>)
 37:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">TypeError</span>, <span class="ruby-value str">&quot;A OpenSSL::X509::Certificate object must be passed.&quot;</span>
 38:       <span class="ruby-keyword kw">end</span>
 39:       
 40:       <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">key</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">OpenSSL</span><span class="ruby-operator">::</span><span class="ruby-constant">PKey</span><span class="ruby-operator">::</span><span class="ruby-constant">RSA</span>)
 41:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">TypeError</span>, <span class="ruby-value str">&quot;A OpenSSL::PKey::RSA object must be passed.&quot;</span>
 42:       <span class="ruby-keyword kw">end</span>
 43:       
 44:       <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">ca</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-operator">::</span><span class="ruby-constant">Array</span>)
 45:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">TypeError</span>, <span class="ruby-value str">&quot;Expected an Array of CA certificate.&quot;</span>
 46:       <span class="ruby-keyword kw">end</span>
 47:       
 48:       <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">annotation</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">annotation</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Annotation</span><span class="ruby-operator">::</span><span class="ruby-constant">Widget</span><span class="ruby-operator">::</span><span class="ruby-constant">Signature</span>)
 49:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">TypeError</span>, <span class="ruby-value str">&quot;Expected a Annotation::Widget::Signature object.&quot;</span>
 50:       <span class="ruby-keyword kw">end</span>
 51:       
 52:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">signfield_size</span>(<span class="ruby-identifier">certificate</span>, <span class="ruby-identifier">key</span>, <span class="ruby-identifier">ca</span> = []) <span class="ruby-comment cmt">#;nodoc:</span>
 53:         <span class="ruby-identifier">datatest</span> = <span class="ruby-value str">&quot;abcdefghijklmnopqrstuvwxyz&quot;</span>
 54:         <span class="ruby-constant">OpenSSL</span><span class="ruby-operator">::</span><span class="ruby-constant">PKCS7</span>.<span class="ruby-identifier">sign</span>(<span class="ruby-identifier">certificate</span>, <span class="ruby-identifier">key</span>, <span class="ruby-identifier">datatest</span>, <span class="ruby-identifier">ca</span>, <span class="ruby-constant">OpenSSL</span><span class="ruby-operator">::</span><span class="ruby-constant">PKCS7</span><span class="ruby-operator">::</span><span class="ruby-constant">DETACHED</span> <span class="ruby-operator">|</span> <span class="ruby-constant">OpenSSL</span><span class="ruby-operator">::</span><span class="ruby-constant">PKCS7</span><span class="ruby-operator">::</span><span class="ruby-constant">BINARY</span>).<span class="ruby-identifier">to_der</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">+</span> <span class="ruby-value">128</span>
 55:       <span class="ruby-keyword kw">end</span>
 56:       
 57:       <span class="ruby-identifier">digsig</span> = <span class="ruby-constant">Signature</span><span class="ruby-operator">::</span><span class="ruby-constant">DigitalSignature</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">set_indirect</span>(<span class="ruby-keyword kw">true</span>)
 58:       
 59:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">annotation</span>.<span class="ruby-identifier">nil?</span>
 60:         <span class="ruby-identifier">annotation</span> = <span class="ruby-constant">Annotation</span><span class="ruby-operator">::</span><span class="ruby-constant">Widget</span><span class="ruby-operator">::</span><span class="ruby-constant">Signature</span>.<span class="ruby-identifier">new</span>
 61:         <span class="ruby-identifier">annotation</span>.<span class="ruby-constant">Rect</span> = <span class="ruby-constant">Rectangle</span>[<span class="ruby-identifier">:llx</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span><span class="ruby-value">.0</span>, <span class="ruby-identifier">:lly</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span><span class="ruby-value">.0</span>, <span class="ruby-identifier">:urx</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span><span class="ruby-value">.0</span>, <span class="ruby-identifier">:ury</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span><span class="ruby-value">.0</span>]        
 62:       <span class="ruby-keyword kw">end</span>
 63:       
 64:       <span class="ruby-identifier">annotation</span>.<span class="ruby-constant">V</span> = <span class="ruby-identifier">digsig</span> ;
 65:       <span class="ruby-identifier">add_field</span>(<span class="ruby-identifier">annotation</span>)
 66:       <span class="ruby-keyword kw">self</span>.<span class="ruby-constant">Catalog</span>.<span class="ruby-constant">AcroForm</span>.<span class="ruby-constant">SigFlags</span> = <span class="ruby-constant">InteractiveForm</span><span class="ruby-operator">::</span><span class="ruby-constant">SigFlags</span><span class="ruby-operator">::</span><span class="ruby-constant">SIGNATURESEXIST</span> <span class="ruby-operator">|</span> <span class="ruby-constant">InteractiveForm</span><span class="ruby-operator">::</span><span class="ruby-constant">SigFlags</span><span class="ruby-operator">::</span><span class="ruby-constant">APPENDONLY</span>
 67:       
 68:       <span class="ruby-identifier">digsig</span>.<span class="ruby-constant">Type</span> = <span class="ruby-identifier">:Sig</span> <span class="ruby-comment cmt">#:nodoc:</span>
 69:       <span class="ruby-identifier">digsig</span>.<span class="ruby-constant">Contents</span> = <span class="ruby-constant">HexaString</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value str">&quot;\x00&quot;</span> <span class="ruby-operator">*</span> <span class="ruby-identifier">signfield_size</span>(<span class="ruby-identifier">certificate</span>, <span class="ruby-identifier">key</span>, <span class="ruby-identifier">ca</span>)) <span class="ruby-comment cmt">#:nodoc:</span>
 70:       <span class="ruby-identifier">digsig</span>.<span class="ruby-constant">Filter</span> = <span class="ruby-constant">Name</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value str">&quot;Adobe.PPKMS&quot;</span>) <span class="ruby-comment cmt">#:nodoc:</span>
 71:       <span class="ruby-identifier">digsig</span>.<span class="ruby-constant">SubFilter</span> = <span class="ruby-constant">Name</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value str">&quot;adbe.pkcs7.detached&quot;</span>) <span class="ruby-comment cmt">#:nodoc:</span>
 72:       <span class="ruby-identifier">digsig</span>.<span class="ruby-constant">ByteRange</span> = [<span class="ruby-value">0</span>, <span class="ruby-value">0</span>, <span class="ruby-value">0</span>, <span class="ruby-value">0</span>] <span class="ruby-comment cmt">#:nodoc:</span>
 73:       
 74:       <span class="ruby-identifier">digsig</span>.<span class="ruby-constant">Location</span> = <span class="ruby-constant">HexaString</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">location</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">location</span>
 75:       <span class="ruby-identifier">digsig</span>.<span class="ruby-constant">ContactInfo</span> = <span class="ruby-constant">HexaString</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">contact</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">contact</span>
 76:       <span class="ruby-identifier">digsig</span>.<span class="ruby-constant">Reason</span> = <span class="ruby-constant">HexaString</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">reason</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">reason</span>
 77:       
 78:       <span class="ruby-comment cmt">#</span>
 79:       <span class="ruby-comment cmt">#  Flattening the PDF to get file view.</span>
 80:       <span class="ruby-comment cmt">#</span>
 81:       <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">compile</span>
 82:       
 83:       <span class="ruby-comment cmt">#</span>
 84:       <span class="ruby-comment cmt"># Creating an empty Xref table to compute signature byte range.</span>
 85:       <span class="ruby-comment cmt">#</span>
 86:       <span class="ruby-identifier">rebuild_dummy_xrefs</span>
 87:       
 88:       <span class="ruby-identifier">sigoffset</span> = <span class="ruby-identifier">get_object_offset</span>(<span class="ruby-identifier">digsig</span>.<span class="ruby-identifier">no</span>, <span class="ruby-identifier">digsig</span>.<span class="ruby-identifier">generation</span>) <span class="ruby-operator">+</span> <span class="ruby-identifier">digsig</span>.<span class="ruby-identifier">sigOffset</span>
 89:       
 90:       <span class="ruby-identifier">digsig</span>.<span class="ruby-constant">ByteRange</span>[<span class="ruby-value">0</span>] = <span class="ruby-value">0</span> 
 91:       <span class="ruby-identifier">digsig</span>.<span class="ruby-constant">ByteRange</span>[<span class="ruby-value">1</span>] = <span class="ruby-identifier">sigoffset</span>
 92:       <span class="ruby-identifier">digsig</span>.<span class="ruby-constant">ByteRange</span>[<span class="ruby-value">2</span>] = <span class="ruby-identifier">sigoffset</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">digsig</span>.<span class="ruby-constant">Contents</span>.<span class="ruby-identifier">size</span>
 93:       
 94:       <span class="ruby-identifier">digsig</span>.<span class="ruby-constant">ByteRange</span>[<span class="ruby-value">3</span>] = <span class="ruby-identifier">filesize</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">digsig</span>.<span class="ruby-constant">ByteRange</span>[<span class="ruby-value">2</span>] <span class="ruby-keyword kw">until</span> <span class="ruby-identifier">digsig</span>.<span class="ruby-constant">ByteRange</span>[<span class="ruby-value">3</span>] <span class="ruby-operator">==</span> <span class="ruby-identifier">filesize</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">digsig</span>.<span class="ruby-constant">ByteRange</span>[<span class="ruby-value">2</span>]
 95:       
 96:       <span class="ruby-comment cmt"># From that point the file size remains constant</span>
 97:       
 98:       <span class="ruby-comment cmt">#</span>
 99:       <span class="ruby-comment cmt"># Correct Xrefs variations caused by ByteRange modifications.</span>
100:       <span class="ruby-comment cmt">#</span>
101:       <span class="ruby-identifier">rebuildxrefs</span>
102:       
103:       <span class="ruby-identifier">filedata</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">to_bin</span>
104:       <span class="ruby-identifier">signable_data</span> = <span class="ruby-identifier">filedata</span>[<span class="ruby-identifier">digsig</span>.<span class="ruby-constant">ByteRange</span>[<span class="ruby-value">0</span>],<span class="ruby-identifier">digsig</span>.<span class="ruby-constant">ByteRange</span>[<span class="ruby-value">1</span>]] <span class="ruby-operator">+</span> <span class="ruby-identifier">filedata</span>[<span class="ruby-identifier">digsig</span>.<span class="ruby-constant">ByteRange</span>[<span class="ruby-value">2</span>],<span class="ruby-identifier">digsig</span>.<span class="ruby-constant">ByteRange</span>[<span class="ruby-value">3</span>]]
105:       
106:       <span class="ruby-identifier">signature</span> = <span class="ruby-constant">OpenSSL</span><span class="ruby-operator">::</span><span class="ruby-constant">PKCS7</span>.<span class="ruby-identifier">sign</span>(<span class="ruby-identifier">certificate</span>, <span class="ruby-identifier">key</span>, <span class="ruby-identifier">signable_data</span>, <span class="ruby-identifier">ca</span>, <span class="ruby-constant">OpenSSL</span><span class="ruby-operator">::</span><span class="ruby-constant">PKCS7</span><span class="ruby-operator">::</span><span class="ruby-constant">DETACHED</span> <span class="ruby-operator">|</span> <span class="ruby-constant">OpenSSL</span><span class="ruby-operator">::</span><span class="ruby-constant">PKCS7</span><span class="ruby-operator">::</span><span class="ruby-constant">BINARY</span>).<span class="ruby-identifier">to_der</span>
107:       <span class="ruby-identifier">digsig</span>.<span class="ruby-constant">Contents</span>[<span class="ruby-value">0</span>, <span class="ruby-identifier">signature</span>.<span class="ruby-identifier">size</span>] = <span class="ruby-identifier">signature</span>
108:       
109:       <span class="ruby-comment cmt">#</span>
110:       <span class="ruby-comment cmt"># No more modification are allowed after signing.</span>
111:       <span class="ruby-comment cmt">#</span>
112:       <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">freeze</span>
113:       
114:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000346" class="method-detail">
        <a name="M000346"></a>

        <div class="method-heading">
          <a href="#M000346" class="method-signature">
          <span class="method-name">to_bin</span><span class="method-args">(params = {})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns the final binary representation of the current document.
</p>
<table>
<tr><td valign="top"><em><a href="PDF.html#M000347">rebuildxrefs</a></em>:</td><td>Computes xrefs while writing <a href="PDF.html#M000339">objects</a>
(default true).

</td></tr>
<tr><td valign="top"><em>obfuscate</em>:</td><td>Do some basic syntactic object obfuscation.

</td></tr>
</table>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000346-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000346-source">
<pre>
     <span class="ruby-comment cmt"># File sources/parser/pdf.rb, line 460</span>
460:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">to_bin</span>(<span class="ruby-identifier">params</span> = {})
461:    
462:       <span class="ruby-identifier">has_objstm</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">indirect_objects</span>.<span class="ruby-identifier">values</span>.<span class="ruby-identifier">any?</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">obj</span><span class="ruby-operator">|</span> <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">ObjectStream</span>)}
463: 
464:       <span class="ruby-identifier">options</span> =
465:       {
466:         <span class="ruby-identifier">:rebuildxrefs</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span>,
467:         <span class="ruby-identifier">:obfuscate</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">false</span>,
468:         <span class="ruby-identifier">:use_xrefstm</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">has_objstm</span>,
469:         <span class="ruby-identifier">:use_xreftable</span> =<span class="ruby-operator">&gt;</span> (<span class="ruby-keyword kw">not</span> <span class="ruby-identifier">has_objstm</span>),
470:         <span class="ruby-identifier">:up_to_revision</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@revisions</span>.<span class="ruby-identifier">size</span>
471:         <span class="ruby-comment cmt">#todo linearize</span>
472:       }
473:       <span class="ruby-identifier">options</span>.<span class="ruby-identifier">update</span>(<span class="ruby-identifier">params</span>)
474: 
475:       <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:up_to_revision</span>] = <span class="ruby-ivar">@revisions</span>.<span class="ruby-identifier">size</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:up_to_revision</span>] <span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@revisions</span>.<span class="ruby-identifier">size</span>
476: 
477:       <span class="ruby-comment cmt"># Reset to default params if no xrefs are chosen (hybrid files not supported yet)</span>
478:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:use_xrefstm</span>] <span class="ruby-operator">==</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:use_xreftable</span>]
479:         <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:use_xrefstm</span>] = <span class="ruby-identifier">has_objstm</span>
480:         <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:use_xreftable</span>] = (<span class="ruby-keyword kw">not</span> <span class="ruby-identifier">has_objstm</span>)
481:       <span class="ruby-keyword kw">end</span>
482: 
483:       <span class="ruby-comment cmt"># Get trailer dictionary</span>
484:       <span class="ruby-identifier">trailer_info</span> = <span class="ruby-identifier">get_trailer_info</span>
485:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">trailer_info</span>.<span class="ruby-identifier">nil?</span>
486:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">InvalidPDF</span>, <span class="ruby-value str">&quot;No trailer information found&quot;</span>
487:       <span class="ruby-keyword kw">end</span>
488:       <span class="ruby-identifier">trailer_dict</span> = <span class="ruby-identifier">trailer_info</span>.<span class="ruby-identifier">dictionary</span>
489:  
490:       <span class="ruby-identifier">prev_xref_offset</span> = <span class="ruby-keyword kw">nil</span>
491:       <span class="ruby-identifier">xrefstm_offset</span> = <span class="ruby-keyword kw">nil</span>
492:       <span class="ruby-identifier">xreftable_offset</span> = <span class="ruby-keyword kw">nil</span>
493:     
494:       <span class="ruby-comment cmt"># Header</span>
495:       <span class="ruby-identifier">bin</span> = <span class="ruby-value str">&quot;&quot;</span>
496:       <span class="ruby-identifier">bin</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-ivar">@header</span>.<span class="ruby-identifier">to_s</span>
497:       
498:       <span class="ruby-comment cmt"># For each revision</span>
499:       <span class="ruby-ivar">@revisions</span>[<span class="ruby-value">0</span>, <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:up_to_revision</span>]].<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">rev</span><span class="ruby-operator">|</span>
500:         
501:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:rebuildxrefs</span>] <span class="ruby-operator">==</span> <span class="ruby-keyword kw">true</span>
502:           <span class="ruby-identifier">lastno_table</span>, <span class="ruby-identifier">lastno_stm</span> = <span class="ruby-value">0</span>, <span class="ruby-value">0</span>
503:           <span class="ruby-identifier">brange_table</span>, <span class="ruby-identifier">brange_stm</span> = <span class="ruby-value">0</span>, <span class="ruby-value">0</span>
504:           
505:           <span class="ruby-identifier">xrefs_stm</span> = [ <span class="ruby-constant">XRef</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">0</span>, <span class="ruby-constant">XRef</span><span class="ruby-operator">::</span><span class="ruby-constant">LASTFREE</span>, <span class="ruby-constant">XRef</span><span class="ruby-operator">::</span><span class="ruby-constant">FREE</span>) ]
506:           <span class="ruby-identifier">xrefs_table</span> = [ <span class="ruby-constant">XRef</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">0</span>, <span class="ruby-constant">XRef</span><span class="ruby-operator">::</span><span class="ruby-constant">LASTFREE</span>, <span class="ruby-constant">XRef</span><span class="ruby-operator">::</span><span class="ruby-constant">FREE</span>) ]
507: 
508:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:use_xreftable</span>] <span class="ruby-operator">==</span> <span class="ruby-keyword kw">true</span>
509:             <span class="ruby-identifier">xrefsection</span> = <span class="ruby-constant">XRef</span><span class="ruby-operator">::</span><span class="ruby-constant">Section</span>.<span class="ruby-identifier">new</span>
510:           <span class="ruby-keyword kw">end</span>
511: 
512:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:use_xrefstm</span>] <span class="ruby-operator">==</span> <span class="ruby-keyword kw">true</span>
513:             <span class="ruby-identifier">xrefstm</span> = <span class="ruby-identifier">rev</span>.<span class="ruby-identifier">xrefstm</span> <span class="ruby-operator">||</span> <span class="ruby-constant">XRefStream</span>.<span class="ruby-identifier">new</span>
514:             <span class="ruby-identifier">add_to_revision</span>(<span class="ruby-identifier">xrefstm</span>, <span class="ruby-identifier">rev</span>) <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">xrefstm</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">rev</span>.<span class="ruby-identifier">xrefstm</span>
515:           <span class="ruby-keyword kw">end</span>
516:         <span class="ruby-keyword kw">end</span>
517:        
518:         <span class="ruby-identifier">objset</span> = <span class="ruby-identifier">rev</span>.<span class="ruby-identifier">body</span>.<span class="ruby-identifier">values</span>
519:         
520:         <span class="ruby-identifier">objset</span>.<span class="ruby-identifier">find_all</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">obj</span><span class="ruby-operator">|</span> <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">ObjectStream</span>)}.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">objstm</span><span class="ruby-operator">|</span>
521:           <span class="ruby-identifier">objset</span> <span class="ruby-operator">|=</span> <span class="ruby-identifier">objstm</span>.<span class="ruby-identifier">objects</span>
522:         <span class="ruby-keyword kw">end</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:rebuildxrefs</span>] <span class="ruby-operator">==</span> <span class="ruby-keyword kw">true</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:use_xrefstm</span>] <span class="ruby-operator">==</span> <span class="ruby-keyword kw">true</span>
523: 
524:         <span class="ruby-identifier">objset</span>.<span class="ruby-identifier">sort</span> <span class="ruby-comment cmt"># process objects in number order</span>
525:         
526:         <span class="ruby-comment cmt"># For each object</span>
527:         <span class="ruby-identifier">objset</span>.<span class="ruby-identifier">sort</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">obj</span><span class="ruby-operator">|</span>
528:          
529:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:rebuildxrefs</span>] <span class="ruby-operator">==</span> <span class="ruby-keyword kw">true</span>
530:            
531:             <span class="ruby-comment cmt"># Adding subsections if needed</span>
532:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:use_xreftable</span>] <span class="ruby-keyword kw">and</span> (<span class="ruby-identifier">obj</span>.<span class="ruby-identifier">no</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">lastno_table</span>).<span class="ruby-identifier">abs</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>
533:               <span class="ruby-identifier">xrefsection</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-constant">XRef</span><span class="ruby-operator">::</span><span class="ruby-constant">Subsection</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">brange_table</span>, <span class="ruby-identifier">xrefs_table</span>)
534: 
535:               <span class="ruby-identifier">xrefs_table</span>.<span class="ruby-identifier">clear</span>
536:               <span class="ruby-identifier">brange_table</span> = <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">no</span>
537:             <span class="ruby-keyword kw">end</span>
538:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:use_xrefstm</span>] <span class="ruby-keyword kw">and</span> (<span class="ruby-identifier">obj</span>.<span class="ruby-identifier">no</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">lastno_stm</span>).<span class="ruby-identifier">abs</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>
539:               <span class="ruby-identifier">xrefs_stm</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">xref</span><span class="ruby-operator">|</span> <span class="ruby-identifier">xrefstm</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">xref</span> <span class="ruby-keyword kw">end</span>
540:               <span class="ruby-identifier">xrefstm</span>.<span class="ruby-constant">Index</span> <span class="ruby-operator">||=</span> []
541:               <span class="ruby-identifier">xrefstm</span>.<span class="ruby-constant">Index</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">brange_stm</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">xrefs_stm</span>.<span class="ruby-identifier">length</span>
542: 
543:               <span class="ruby-identifier">xrefs_stm</span>.<span class="ruby-identifier">clear</span>
544:               <span class="ruby-identifier">brange_stm</span> = <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">no</span>
545:             <span class="ruby-keyword kw">end</span>
546: 
547:             <span class="ruby-comment cmt"># Process embedded objects</span>
548:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:use_xrefstm</span>] <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">parent</span> <span class="ruby-operator">!=</span> <span class="ruby-identifier">obj</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">parent</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">ObjectStream</span>)
549:               <span class="ruby-identifier">index</span> = <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">parent</span>.<span class="ruby-identifier">index</span>(<span class="ruby-identifier">obj</span>.<span class="ruby-identifier">no</span>)
550:              
551:               <span class="ruby-identifier">xrefs_stm</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-constant">XRefToCompressedObj</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">obj</span>.<span class="ruby-identifier">parent</span>.<span class="ruby-identifier">no</span>, <span class="ruby-identifier">index</span>)
552:               
553:               <span class="ruby-identifier">lastno_stm</span> = <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">no</span>
554:             <span class="ruby-keyword kw">else</span>
555:               <span class="ruby-identifier">xrefs_stm</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-constant">XRef</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">bin</span>.<span class="ruby-identifier">size</span>, <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">generation</span>, <span class="ruby-constant">XRef</span><span class="ruby-operator">::</span><span class="ruby-constant">USED</span>)
556:               <span class="ruby-identifier">xrefs_table</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-constant">XRef</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">bin</span>.<span class="ruby-identifier">size</span>, <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">generation</span>, <span class="ruby-constant">XRef</span><span class="ruby-operator">::</span><span class="ruby-constant">USED</span>)
557: 
558:               <span class="ruby-identifier">lastno_table</span> = <span class="ruby-identifier">lastno_stm</span> = <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">no</span>
559:             <span class="ruby-keyword kw">end</span>
560: 
561:           <span class="ruby-keyword kw">end</span>
562:          
563:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">parent</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">obj</span> <span class="ruby-keyword kw">or</span> <span class="ruby-keyword kw">not</span> <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">parent</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">ObjectStream</span>)
564:            
565:             <span class="ruby-comment cmt"># Finalize XRefStm</span>
566:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:rebuildxrefs</span>] <span class="ruby-operator">==</span> <span class="ruby-keyword kw">true</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:use_xrefstm</span>] <span class="ruby-operator">==</span> <span class="ruby-keyword kw">true</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">obj</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">xrefstm</span>
567:               <span class="ruby-identifier">xrefstm_offset</span> = <span class="ruby-identifier">bin</span>.<span class="ruby-identifier">size</span>
568:    
569:               <span class="ruby-identifier">xrefs_stm</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">xref</span><span class="ruby-operator">|</span> <span class="ruby-identifier">xrefstm</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">xref</span> <span class="ruby-keyword kw">end</span>
570: 
571:               <span class="ruby-identifier">xrefstm</span>.<span class="ruby-constant">W</span> = [ <span class="ruby-value">1</span>, (<span class="ruby-identifier">xrefstm_offset</span>.<span class="ruby-identifier">to_s</span>(<span class="ruby-value">2</span>).<span class="ruby-identifier">size</span> <span class="ruby-operator">+</span> <span class="ruby-value">7</span>) <span class="ruby-operator">&gt;&gt;</span> <span class="ruby-value">3</span>, <span class="ruby-value">2</span> ]
572:               <span class="ruby-identifier">xrefstm</span>.<span class="ruby-constant">Index</span> <span class="ruby-operator">||=</span> []
573:               <span class="ruby-identifier">xrefstm</span>.<span class="ruby-constant">Index</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">brange_stm</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">xrefs_stm</span>.<span class="ruby-identifier">size</span>
574:    
575:               <span class="ruby-identifier">xrefstm</span>.<span class="ruby-identifier">dictionary</span> = <span class="ruby-identifier">xrefstm</span>.<span class="ruby-identifier">dictionary</span>.<span class="ruby-identifier">merge</span>(<span class="ruby-identifier">trailer_dict</span>) 
576:               <span class="ruby-identifier">xrefstm</span>.<span class="ruby-constant">Prev</span> = <span class="ruby-identifier">prev_xref_offset</span>
577: 
578:               <span class="ruby-identifier">rev</span>.<span class="ruby-identifier">trailer</span>.<span class="ruby-identifier">dictionary</span> = <span class="ruby-keyword kw">nil</span>
579: 
580:               <span class="ruby-identifier">add_to_revision</span>(<span class="ruby-identifier">xrefstm</span>, <span class="ruby-identifier">rev</span>)
581: 
582:               <span class="ruby-identifier">xrefstm</span>.<span class="ruby-identifier">pre_build</span>
583:               <span class="ruby-identifier">xrefstm</span>.<span class="ruby-identifier">post_build</span>
584:             <span class="ruby-keyword kw">end</span>
585: 
586:             <span class="ruby-identifier">bin</span> <span class="ruby-operator">&lt;&lt;</span> (<span class="ruby-identifier">options</span>[<span class="ruby-identifier">:obfuscate</span>] <span class="ruby-operator">==</span> <span class="ruby-keyword kw">true</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">to_obfuscated_str</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">to_s</span>)
587:           <span class="ruby-keyword kw">end</span>
588:         }
589:       
590:         <span class="ruby-identifier">rev</span>.<span class="ruby-identifier">trailer</span> <span class="ruby-operator">||=</span> <span class="ruby-constant">Trailer</span>.<span class="ruby-identifier">new</span>
591:         
592:         <span class="ruby-comment cmt"># XRef table</span>
593:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:rebuildxrefs</span>] <span class="ruby-operator">==</span> <span class="ruby-keyword kw">true</span>
594:  
595:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:use_xreftable</span>] <span class="ruby-operator">==</span> <span class="ruby-keyword kw">true</span>
596:             <span class="ruby-identifier">table_offset</span> = <span class="ruby-identifier">bin</span>.<span class="ruby-identifier">size</span>
597:             
598:             <span class="ruby-identifier">xrefsection</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-constant">XRef</span><span class="ruby-operator">::</span><span class="ruby-constant">Subsection</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">brange_table</span>, <span class="ruby-identifier">xrefs_table</span>)
599:             <span class="ruby-identifier">rev</span>.<span class="ruby-identifier">xreftable</span> = <span class="ruby-identifier">xrefsection</span>
600:  
601:             <span class="ruby-identifier">rev</span>.<span class="ruby-identifier">trailer</span>.<span class="ruby-identifier">dictionary</span> = <span class="ruby-identifier">trailer_dict</span>
602:             <span class="ruby-identifier">rev</span>.<span class="ruby-identifier">trailer</span>.<span class="ruby-constant">Size</span> = <span class="ruby-identifier">objset</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>
603:             <span class="ruby-identifier">rev</span>.<span class="ruby-identifier">trailer</span>.<span class="ruby-constant">Prev</span> = <span class="ruby-identifier">prev_xref_offset</span>
604: 
605:             <span class="ruby-identifier">rev</span>.<span class="ruby-identifier">trailer</span>.<span class="ruby-constant">XRefStm</span> = <span class="ruby-identifier">xrefstm_offset</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:use_xrefstm</span>] <span class="ruby-operator">==</span> <span class="ruby-keyword kw">true</span>
606:           <span class="ruby-keyword kw">end</span>
607: 
608:           <span class="ruby-identifier">startxref</span> = <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:use_xreftable</span>] <span class="ruby-operator">==</span> <span class="ruby-keyword kw">true</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">table_offset</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">xrefstm_offset</span>
609:           <span class="ruby-identifier">rev</span>.<span class="ruby-identifier">trailer</span>.<span class="ruby-identifier">startxref</span> = <span class="ruby-identifier">prev_xref_offset</span> = <span class="ruby-identifier">startxref</span>
610: 
611:         <span class="ruby-keyword kw">end</span> <span class="ruby-comment cmt"># end each rev</span>
612:         
613:         <span class="ruby-comment cmt"># Trailer</span>
614: 
615:         <span class="ruby-identifier">bin</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">rev</span>.<span class="ruby-identifier">xreftable</span>.<span class="ruby-identifier">to_s</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:use_xreftable</span>] <span class="ruby-operator">==</span> <span class="ruby-keyword kw">true</span>
616:         <span class="ruby-identifier">bin</span> <span class="ruby-operator">&lt;&lt;</span> (<span class="ruby-identifier">options</span>[<span class="ruby-identifier">:obfuscate</span>] <span class="ruby-operator">==</span> <span class="ruby-keyword kw">true</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">rev</span>.<span class="ruby-identifier">trailer</span>.<span class="ruby-identifier">to_obfuscated_str</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">rev</span>.<span class="ruby-identifier">trailer</span>.<span class="ruby-identifier">to_s</span>)
617:         
618:       <span class="ruby-keyword kw">end</span>
619:       
620:       <span class="ruby-identifier">bin</span>
621:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>


    </div>


  </div>


<div id="validator-badges">
  <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
</div>

</body>
</html>